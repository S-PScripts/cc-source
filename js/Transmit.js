!function(e,t){"function"==typeof define&&define.amd?define(["comms.websocket","student","modules/debug"],t):"object"==typeof exports?module.exports=t(require("comms.websocket"),require("student"),require("modules/debug")):e.NSLibrary.Transmit=t()}(this,function(a,t,r){let d=1;var n={};chrome.runtime.onMessage.addListener(function(e,t,r){1==e.quickRegister&&o.senddata(e.cid,e.d)});class o{constructor(e){return void 0===e&&r("undefined CID supplied:"),this.cid=e,this.utf8=!!t.Connections[e]&&t.Connections[e].utf8,n[e]=this}convertStringToBinary(e){var t=e.length;let r=new Uint8Array(new ArrayBuffer(t));for(i=0;i<t;i++)r[i]=e.charCodeAt(i);return r}BigEasy(){for(var e=d++,t=0,r=this.d.length,n=r;0<n;){var i,o=n<=16189?(i=n,0):(i=16189,1);n-=i;var s=String.fromCharCode(154)+String.fromCharCode(0)+String.fromCharCode(255&r)+String.fromCharCode(r>>8&255)+String.fromCharCode(r>>16&255)+String.fromCharCode(r>>24&255)+String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255)+String.fromCharCode(o)+this.d.substr(t,i);t+=i;o=this.cid+s;tcpConnected?tcpPage.postMessage({data:s}):a.send(this.convertStringToBinary(o))}}ASock(){var e=this.cid+this.d.replace(/\u20AC/g,String.fromCharCode(128));a.send(this.convertStringToBinary(e))}USock(){var e=this.cid+this.d;a.send(this.convertStringToBinary(e))}Push(e,t=5,r=0){var n=a.instance.websocket["readyState"],i=Math.ceil(t/2),o=50*(r+1);return t<=r||1<n&&i<=r?(console.warn("WebSocket message not sent. State:[%s] Tries:[%s]",n,r),r):1===n?(a.send(e),r):void setTimeout(()=>{transmit.Push(e,t,r+1)},o)}Send(e){this.d=e,null!=a.instance?localStorage.Comms=JSON.stringify(a):a=JSON.parse(localStorage.Comms),(null==a.instance?1===localStorage.Comms.instance.websocket.readyState||tcpConnected:1===a.instance.websocket.readyState||tcpConnected)&&(this.d.length<=16200?tcpConnected?tcpPage.postMessage({data:this.d}):this.utf8?this.USock():this.ASock():this.BigEasy())}static senddata(e,t){var r=n[e];return(r||new o(e)).Send(t)}}return o});