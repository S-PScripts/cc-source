!function(e){"function"==typeof define&&define.amd?define(["comms.nc.protocol","comms.websocket","student","Transmit","utf8","comms.websocket","showlib","disconnect","models/register","models/Tab","models/sysinfo","modules/debug","modules/mph","background/thumb/videoStream","models/Tab"],e):"object"==typeof exports&&(module.exports=e(require("comms.nc.protocol"),require("comms.websocket"),require("student"),require("Transmit"),require("utf8"),require("comms.websocket"),require("showlib"),require("disconnect"),require("models/register"),require("models/Tab"),require("models/sysinfo"),require("modules/debug"),require("modules/mph"),require("background/thumb/videoStream")))}(function(e,t,r,o,n,a,i,s,c,m,u,l,g,d,m){var S=void 0;chrome.runtime.onMessage.addListener(function(e,t,o){1==e.registerDevice&&registerDevice(e.accountID,e.siteID,e.region)});class h{constructor(e){return h.bind(e),e}static bind(e){e.getTeacherName=this.getTeacherName,e.getLessonName=this.getLessonName,e.getRoom=this.getRoom,e.getStudent=this.getStudent,e.getUserNameOnly=this.getUserNameOnly,e.studentRegister=this.studentRegister,e.cancelRegister=this.cancelRegister,e.setRoom=this.setRoom,e.handshake=this.handshake,e.announceRoom=this.announceRoom,e.sendQAResponse=this.sendQAResponse,e.sendFeedbackResponse=this.sendFeedbackResponse,e.getSurveyQuestion=this.getSurveyQuestion,e.getSurveyAnswers=this.getSurveyAnswers,e.getSurveyResults=this.getSurveyResults,e.getSurveyType=this.getSurveyType,e.sendSurveyResponse=this.sendSurveyResponse,e.setSurveyResults=this.setSurveyResults,e.cancelSurvey=this.cancelSurvey,e.scaleShow=this.scaleShow,e.getShow=this.getShow,e.showHRNotification=this.showHRNotification,e.getActiveSocket=this.getActiveSocket,e.getSysInfo=()=>u,e.makePPH=g.make,e.hangupAndCloseConnection=s.reset,e.dbg={getCanvas:d.getCanvas,getVideo:d.getVideo,getStream:d.getStream},e.gdc=v,e.registerDevice=this.registerDevice,e.startChat=this.startChat,e.setGWFlag=this.setGWFlag,e.getGWFlag=this.getGWFlag,e.supportToolTab=this.supportToolTab,e.joinClass=this.joinClass,e.cancelJoinClass=this.cancelJoinClass}static registerDevice(s,r,n){require(["modules/cicregistration","modules/initialize","modules/ciccore"],function(e,t,o){e.cic.register(!1,s,r,n,function(){t(),o.core.updateHardwareInventory(),o.core.updateSoftwareInventory()})})}static startChat(){chrome.runtime.sendMessage({startChat:!0})}static joinClass(e){localStorage.roomspec=e.trim(),chrome.runtime.sendMessage({sendClassCode:!0,classCode:e.trim()}),localStorage.connectionStatusType=0}static cancelJoinClass(){localStorage.removeClassCodeUI=!1,localStorage.roomspec=localStorage.storedChannel,chrome.runtime.sendMessage({cancelJoinClass:!0,classCode:localStorage.storedChannel}),localStorage.connectionStatusType=0}static setGWFlag(e){localStorage.setItem("flag",e)}static getGWFlag(){return localStorage.getItem("flag")}static supportToolTab(e,t){m.Make(e,t)}static cancelRegister(){s.Register()}static cancelSurvey(){s.Survey()}static senddata(e,t){if(void 0!==e)return new o(e).Send(t)}static getTeacherName(){return r.Register.Teacher}static getLessonName(){return r.Register.Lesson}static getRoom(){return r.Register.Room}static getStudent(){var e=r.Register.Student;return e||!1}static getUserNameOnly(){return!!(512&r.Register.Flags)}static studentRegister(e){r.Register.student(e).then(function(e){chrome.runtime.sendMessage({quickRegister:!0,cid:localStorage.registerUserCid,d:e}),s.Register()})}static sendQAResponse(e,t){o.senddata(r.QA.Cid,String.fromCharCode(198,0,198,0,0,0,1,0,r.QA.RoundNum,0,0,0,e,0,0,0)+t+String.fromCharCode(0))}static sendFeedbackResponse(e){o.senddata(r.Feedback.Cid,String.fromCharCode(236,0,0,0,e,0,0,0)),m.Remove("Feedback")}static getSurveyQuestion(){chrome.runtime.sendMessage({getSurveyQuestion:!0},function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")})}static getSurveyAnswers(){chrome.runtime.sendMessage({getSurveyAnswers:!0},function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")})}static getSurveyType(){chrome.runtime.sendMessage({getSurveyType:!0},function(e){return e})}static sendSurveyResponse(e){chrome.runtime.sendMessage({sendSurveyResponse:!0,response:e},function(){chrome.runtime.sendMessage({closeSurvey:!0})})}static setSurveyResults(e){localStorage.surveyResults=e}static getSurveyResults(){return localStorage.surveyResults}static scaleShow(e,t){r.ScreenDimensions.height=e,r.ScreenDimensions.width=t,i.Scale(e,t)}static getShow(e,t,o){var s=i.displayCanvas;return i.syncCanvas(t),(i.view.tab|i.view.window)!==e&&(i.view.tab?(i.closeTab(),i.view.tab=e,i.backBufferContext.drawImage(s,0,0)):i.view.window&&i.closeWindow()),i.isShowing||(o?i.closeWindow(e):i.closeTab(e)),i.backBufferCanvas}static showHRNotification(e,t,o){e={body:o,icon:e};S&&S.close(),S=new Notification(t,e)}static setRoom(e){sessionStorage.room!==e&&(sessionStorage.room=e,chrome.runtime.sendMessage({storeLocal:!0,data:{lastRoom:e}}),r.reconnectMode.active=0),r.Opened&&(r.Room.Changed=!0,l("setRoom (old room name):[ "+r.Room.Name+" ]"),e!=r.Room.Name&&(function(){for(var e in r.Connections)new o(e,String.fromCharCode(188,0,0,0)).Send()}(),null!=(r.Room.Name=e)&&a.instance.STATUS(e,1),r.reconnectMode.active&&announceRoom(r.reconnectMode.id),announceRoom(e),tcpPage&&tcpPage.postMessage({clientName:localStorage.clientName,macAddress:localStorage.macAddress,roomName:localStorage.room})))}static handshake(){var e;l("HANDSHAKE"),chrome.runtime.sendMessage({storeLocal:!0,data:{connectionState:"connected_NCS"}}),clearTimeout(r.reconnectMode.expiryHandler),r.reconnectMode.expiryHandler=setTimeout(r.reconnectMode.clear,1e4),l("Connected, Open Channel"),l("Send OPEN"),a.instance.OPEN(),sessionStorage.room?e=sessionStorage.room:"roomSpecified"==localStorage.roomType&&(e=localStorage.room,sessionStorage.room=localStorage.room),l("STATUS"),l("ANNOUNCE: "+e),r.reconnectMode.active,l("Configure a HeartBeat"),a.mechanism.HeartBeat()}static announceRoom(e){var t,o,s;z=localStorage.z,l("announce room: "+e),e=e||sessionStorage.room,1.4<=r.ServerVersion&&(t=0,s="",o={name:localStorage.clientName,room:e},n.Required(o.name)&&(t=3,o.name="<name>"),n.Required(o.room)&&(t|=9,o.room="<room>"),0!==t&&(s=String.fromCharCode(t),2&t&&(s+=n.PrefixEncode(localStorage.clientName)+z),8&t&&(s+=n.PrefixEncode(e)+z)),s=String.fromCharCode(185,0,0,16,0,0,0,10,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)+o.name+z+o.room+z+s+z+n.ForceEncode(localStorage.macAddress)+z+n.ForceEncode(localStorage.fullemail)+z,a.instance.BROADCASTDATA(e,s))}static getActiveSocket(){return a.instance?a.instance.websocket:void 0}}function v(e,r){var n=new Event(arguments.callee.name);crypto.subtle.digest({name:"SHA-256"},e).then(function(e){var t,o=new Uint32Array(e),s=new Uint32Array(i17n);for(t in o)if(o[t]!==s[t])return!1;("HTMLInputElement"==r.constructor.name?r.ownerDocument.defaultView.window:r).dispatchEvent(n)})}return h});