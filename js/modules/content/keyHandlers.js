!function(e,n){"function"==typeof define&&define.amd?define("content/keyHandlers",["content/clientMessaging"],n):"object"==typeof exports?module.exports=n(require("content/clientMessaging")):(e.ns=e.ns||{content:{}},e.ns.content.keyHandlers=n(e.ns.content.clientMessaging))}(this,function(t){var s,a=1,o=[],c=[],i=0;let r=0;const d=10;function u(){c[i]=o.join(""),o=[],i=0,t.sendRuntime(c.join(""),a),c=[],window.clearTimeout(s)}function n(e){switch(window.clearTimeout(s),s=window.setTimeout(u,1e4),e.which){case 27:u();break;case 9:o.push("\t");break;case 8:var n;0!=o.length||(n=c.pop())&&(o=n.split("")),o.pop()}return!0}var m=null,l=!1;function w(e){if(10<(new Date).getTime()-m||null==m||0==l)switch(m=(new Date).getTime(),e.which){case 8:case 37:case 127:break;case 13:case 27:case 46:case 63:case 190:u();break;case 32:o.push(e.key),c[i]=o.join(""),i&&i%14==0?(t.sendRuntime(c.join(""),a),i=0,c=[],window.clearTimeout(s)):i++,o=[];break;default:var n=Date.now();if(n-r<d)return;r=n,o.push(e.key)}return!0}function E(e){e.contentDocument?(e.contentDocument.addEventListener("keypress",w,!0),e.contentDocument.addEventListener("keydown",n,!0)):e.srcElement.contentDocument?(e.srcElement.contentDocument.addEventListener("keypress",w,!0),e.srcElement.contentDocument.addEventListener("keydown",n,!0)):e.srcElement.contentEditable&&(e.srcElement.addEventListener("keypress",w,!0),e.srcElement.addEventListener("keydown",n,!0))}function e(e){e.target.addEventListener("keypress",w,!0),e.target.addEventListener("keydown",n,!0)}function p(e){var n;e.hasOwnProperty("path")?"IFRAME"!==(n=e.path[0]).tagName||E(n):"TEXTAREA"===e.target.tagName?(l=!0,E(e)):"IFRAME"===e.target.tagName?E(e):"DIV"===e.target.tagName?(E(e),l=!0):"INPUT"===e.target.tagName&&(l=!0,E(e))}return{control:n,input:w,listen:function(){window.addEventListener("keypress",w),window.addEventListener("keydown",n),document.body.addEventListener("focusin",p,!0),document.addEventListener("focusin",e,!0)}}});