define([],function(){var c,a;return{updateDevice:function(){return new Promise(function(o,e){window.crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-384"},!1,["deriveKey","deriveBits"]).then(function(e){var n,t,r;n=o,t=e.publicKey,r=e.privateKey,window.crypto.subtle.exportKey("spki",t).then(function(e){e=new Uint8Array(e),e=Array.from(new Uint8Array(e)).map(e=>("00"+e.toString(16)).slice(-2)).join("");!function(t,e,r){var i=new XMLHttpRequest;!function(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}(localStorage.region)?"nsclassroomapi"==localStorage.region?i.open("POST","https://nsclassroomapi.azurewebsites.net/api/Devices/updateDevice"):i.open("POST","https://api-"+localStorage.region+".classroom.cloud/api/Devices/updateDevice"):i.open("POST",localStorage.region+"/api/Devices/updateDevice");i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Accept","application/json");e={accountID:localStorage.accountID,deviceID:localStorage.deviceID,newID:e};i.send(JSON.stringify(e)),i.onreadystatechange=function(){var n,e,o;this.readyState===i.DONE&&200===this.status&&(jsonResponse=JSON.parse(i.responseText),e=jsonResponse.newID,localStorage.deviceID=jsonResponse.deviceID,n=t,e=function(t){if(!t)return new Uint8Array;const r=[];for(let e=0,n=t.length;e<n;e+=2)r.push(parseInt(t.substr(e,2),16));return new Uint8Array(r)}(e),o=r,window.crypto.subtle.importKey("spki",e,{name:"ECDH",namedCurve:"P-384"},!0,[]).then(function(e){var t,r;t=e,r=o,new Promise(function(e,n){e(window.crypto.subtle.deriveBits({name:"ECDH",namedCurve:"P-384",public:t},r,384))}).then(function(e){c=e,n()})}).catch(function(e){console.log("error message: "+e)}))},i.onerror=function(){console.log("error")}}(n,e,r)}).catch(function(e){console.error(e)})}).catch(function(e){console.error(e)})})},encrypt:function(t){return new Promise(function(i,e){let n=(new TextEncoder).encode(t);a=window.crypto.getRandomValues(new Uint8Array(16)),window.crypto.subtle.digest("SHA-256",c).then(function(e){window.crypto.subtle.importKey("raw",new Uint8Array(e),{name:"AES-CBC",length:256},!0,["encrypt","decrypt"]).then(function(e){var t,r,o;t=e,r=a,o=n,new Promise(function(e,n){e(window.crypto.subtle.encrypt({name:"AES-CBC",iv:r},t,o))}).then(function(e){e=new Uint8Array(e);let n=new Uint8Array(e.length+a.length);n.set(a,0),n.set(e,a.length);e="v1"+function(e){for(var n="",t=new Uint8Array(e),r=t.byteLength,o=0;o<r;o++)n+=String.fromCharCode(t[o]);return window.btoa(n)}(n);i(e)}).catch(function(e){console.log("error message: "+e)})}).catch(function(e){console.error(e)})})})},decrypt:function(o){return new Promise(function(n,e){let t=o.replace(/['"]+/g,""),r=function(e){for(var n=window.atob(e),t=n.length,r=new Uint8Array(t),o=0;o<t;o++)r[o]=n.charCodeAt(o);return r.buffer}(t.substr(2,o.length-1));a=r.slice(0,16);let i=r.slice(16);window.crypto.subtle.digest("SHA-256",c).then(function(e){window.crypto.subtle.importKey("raw",new Uint8Array(e),{name:"AES-CBC",length:256},!0,["encrypt","decrypt"]).then(function(e){var t,r,o;t=e,r=new Uint8Array(a),o=new Uint8Array(i),new Promise(function(e,n){e(window.crypto.subtle.decrypt({name:"AES-CBC",iv:r},t,o))}).then(function(e){e=(new TextDecoder).decode(new Uint8Array(e));n(e)}).catch(function(e){console.log("error message: "+e.toString)})}).catch(function(e){console.error(e)})})})},keys:{sharedKey:c,iv:a}}});