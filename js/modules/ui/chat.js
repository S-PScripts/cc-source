localStorage.chatUrl=document.location.href,require(["modules/translate"],e=>e());var instance,CID=localStorage.CID,oldtimestamp=null;let instancesArray=JSON.parse(localStorage.chatInstances);null!=instancesArray[CID]&&(instance=JSON.parse(instancesArray[CID]));var ignoreRefresh=!1,pageRefreshed=!1,hasJoinedMessageReceived=!1;1==isRefreshed()&&chrome.runtime.sendMessage({messageForTabID:!0},function(e){let t=Object.values(JSON.parse(localStorage.chatInstances));t.forEach(function(e){JSON.parse(e).tabID==localStorage.chatTabIDRefresh&&(instance=JSON.parse(e),chrome.runtime.sendMessage({setTarget:!0,element:JSON.stringify(main),instance:instance}),hasJoinedMessageReceived=!(pageRefreshed=!0))})});var isSendClearClicked=!1,addJoinedMessageCalled=!1;const main=document.querySelector("#main"),sendButton=document.querySelector("#sendButton"),message=document.querySelector("#message");document.getElementById("footerCustomeSpan").innerHTML=localStorage.copyright;var screenWidth=window.screen.width,screenHeight=window.screen.height,customHeader=document.getElementById("customHeader"),customFooter=document.getElementById("customFooter"),imgIcon=document.getElementById("headerIconImg"),chatAreaBox=document.getElementById("chatAreaBox"),isLandscape="true";function sendAndClear(){chrome.runtime.sendMessage({sendMessage:!0,instance:instance,messageText:message.value}),isSendClearClicked=!0,message.value="",message.focus()}function setTarget(e,t){for(var s=e.length,a=0;a<s;a++){var n=document.createElement("div");n.innerHTML=e[a],n.classList.add("message"),main&&(main.appendChild(n),main.scrollTop=99999999)}}function isRefreshed(){return-1!=document.cookie.indexOf("mycookie")||!(document.cookie="mycookie=1")}function addJoinedMessage(e,t){var s=document.createElement("div");s.innerHTML=e,s.classList.add("join"),t&&(t.appendChild(s),t.scrollTop=99999999)}function createMessageElement(e,t){var s=document.createElement("div");s.innerHTML=e,s.classList.add("message"),t&&(t.appendChild(s),t.scrollTop=99999999)}function addLeftMessage(e,t,s,a){const n=document.createElement("div");n.innerHTML=`<b>${a}</b>`,n.classList.add("leave"),t.push(n),s&&(s.appendChild(n),s.scrollTop=99999999),mIX=e.members.indexOf(from),-1<mIX&&e.members.splice(mIX,1),chrome.runtime.sendMessage({addLeftMessage:!0,cachedMessages:JSON.stringify(chat.cachedMessages),translatedText:translate,instance:e})}"true"==(isLandscape=screenWidth<screenHeight?"false":isLandscape)||1080<=parseInt(screenWidth)||1024<=parseInt(screenWidth)?(imgIcon.style.marginLeft="62.5%",customHeader.style.width="910px",customFooter.style.width="910px",chatAreaBox.style.width="900px"):900<=parseInt(screenWidth)?(imgIcon.style.marginLeft="58.5%",customHeader.style.width="810px",customFooter.style.width="810px",chatAreaBox.style.width="770px"):720<=parseInt(screenWidth)?(imgIcon.style.marginLeft="53.5%",customHeader.style.width="710px",customFooter.style.width="710px",chatAreaBox.style.width="700px"):600<=parseInt(screenWidth)?(imgIcon.style.marginLeft="35.5%",customHeader.style.width="510px",customFooter.style.width="510px",chatAreaBox.style.width="500px"):(imgIcon.style.marginLeft="32.5%",customHeader.style.width="480px",customFooter.style.width="480px",chatAreaBox.style.width="460px"),customHeader.style.backgroundColor=localStorage.customBackgroundColour,customFooter.style.backgroundColor=localStorage.customBackgroundColour,0==isRefreshed()&&chrome.runtime.sendMessage({setTarget:!0,element:JSON.stringify(main),instance:instance}),chrome.runtime.onMessage.addListener(function(e,t,s){(1==e.chatMessageUpdate&&e.instance.tabID==localStorage.chatTabIDRefresh||1==pageRefreshed)&&1==pageRefreshed&&(hasJoinedMessageReceived=!(pageRefreshed=!1),1==addJoinedMessageCalled?(addJoinedMessageCalled=!1,(null==oldtimestamp||oldtimestamp+2e3<(new Date).getTime())&&setTarget(JSON.parse(e.cachedMessages),e.element)):setTarget(JSON.parse(e.cachedMessages),e.element))}),chrome.runtime.onMessage.addListener(function(e,t,s){1==e.addLeftMessage&&e.instance.tabID==localStorage.chatTabIDRefresh&&addLeftMessage(JSON.parse(e.instance),e.cachedMessages,main,e.translatedText)}),chrome.runtime.onMessage.addListener(function(e,t,s){1==e.createMessageElement&&createMessageElement(e.translatedText,main,e)}),chrome.runtime.onMessage.addListener(function(e,t,s){1==e.getChatWindowID&&chrome.runtime.sendMessage({focusChat:!0})}),chrome.runtime.onMessage.addListener(function(e,t,s){1==e.addJoinedMessage&&0==hasJoinedMessageReceived&&(oldtimestamp=(new Date).getTime(),hasJoinedMessageReceived=!0,addJoinedMessage(e.translatedText,main),addJoinedMessageCalled=!0)}),sendButton.addEventListener("click",sendAndClear),message.addEventListener("keyup",e=>{13===e.keyCode&&(e.preventDefault(),sendAndClear())}),window.addEventListener("resize",function(){location.reload()}),window.onbeforeunload=function(e){localStorage.tabToDelete=localStorage.chatTabIDRefresh,hasJoinedMessageReceived=!1};