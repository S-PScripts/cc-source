define(["background/observable","modules/translate","modules/extension"],function(e,t,r){var n,c,s,l,o,a,d,u,g,p,m,y,h,I,x,B,f,E;t();var A=null,C=0;function v(){let e=new Date;(0==C||2e3<e.getTime()-C.getTime())&&(C=e,chrome.system.display.getInfo(function(e){var{width:t,height:n}=e[0].bounds,o=parseInt(.8*t),e=parseInt(.9*n);!function(e,t,n,o){e=parseInt((e-n)/2),t=parseInt((t-o)/4);chrome.runtime.sendMessage({createWindow:!0,windowData:{url:"safeguardingresourceslist.html",focused:!0,type:"popup",width:n,height:o,left:e,top:t}},function(e){winID=e.id})}(t,n,localStorage.safeguardingWidth=o,localStorage.safeguardingHeight=e)}))}function S(){navigator.onLine?(A=(new Date).getTime(),chrome.runtime.sendMessage({retrieveReportConcernDialogConfig:!0})):chrome.runtime.sendMessage({createWindow:!0,windowData:{url:"concerntryagainlater.html",focused:!0,type:"popup",width:600,height:120,left:parseInt((screen.width-600)/2),top:parseInt((screen.height-120)/4)}},function(){})}function b(e){localStorage.joinClassInitiated=!0,function(t){var e={deviceID:localStorage.deviceID,accountID:localStorage.accountID};var n=localStorage.region;var e=JSON.stringify(e),o=new XMLHttpRequest;!function(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}(n)?"nsclassroomapi"==n?o.open("POST","https://nsclassroomapi.azurewebsites.net/api/devices/classcode/"+t+"/Validate"):o.open("POST","https://api-"+n+".classroom.cloud/api/devices/classcode/"+t+"/Validate"):o.open("POST",n+"/api/devices/classcode/"+t+"/Validate");o.setRequestHeader("Content-Type","application/json"),o.send(e),o.onreadystatechange=function(e){this.readyState===o.DONE&&200===this.status&&this.response&&(1==JSON.parse(this.response).valid?(localStorage.joiningClassInProgress=!0,localStorage.lastEnteredValidCode=t,r.joinClass(t),R(!0)):R(!1))}}(e)}var T=localStorage.getItem("enableSupportTool");function w(){var e,t=document.getElementById("rewardsContainer");null==(n=localStorage.rewardCount)||0==parseInt(n)||"undefined"==n?(document.getElementById("toolbarUIButtonsContainer").style.marginTop="30px",t.parentNode.removeChild(t)):1==parseInt(n)?(L(),t.style.marginBottom="5px"):2==parseInt(n)?(L(),L(),t.style.marginBottom="5px"):3==parseInt(n)?(L(),L(),L(),t.style.marginBottom="5px"):4==parseInt(n)?(L(),L(),L(),L(),t.style.marginBottom="5px"):(L(),e=document.getElementById("rewardsContainer"),(t=document.createElement("div")).innerHTML=n,t.style.fontSize="35px",t.style.color="#FFFFFF",t.style.alignSelf="end",e.appendChild(t))}function L(){var e=document.getElementById("rewardsContainer"),t=document.createElement("img");t.style.width="32px",t.style.height="32px",t.src="images/rewards.png",e.appendChild(t)}function k(){var e,t;"true"==T?((e=document.createElement("img")).id="supportTool",e.src="images/supporttool.png",e.style.width="22px",e.style.height="24px",e.style.cursor="pointer",document.getElementById("supportToolIconContainer").appendChild(e)):null!=(t=document.getElementById("supportTool"))&&t.parentNode.removeChild(t),null!=(t=document.getElementById("supportTool"))&&t.addEventListener("click",function(e){r.supportToolTab("supporttool.html","Support Tool")})}function H(e){var t,n;"true"==localStorage.isReportConcernEnabled&&"true"==localStorage.isReportConcernEnabled&&(e?(chrome.runtime.sendMessage({getLocal:!0},function(e){0}),n=y+"\n"+E,(t=document.createElement("button")).style.width="40px",t.style.height="40px",t.style.paddingLeft="6px",t.style.marginTop="1px",t.title=n,t.id="reportConcernBtn",t.innerHTML='<img src="images/reportconcern.png" style="width:28px; height 28px;"/>',document.getElementById("toolbarUIButtonsContainer").appendChild(t),null!=(n=document.getElementById("reportConcernBtn"))&&n.addEventListener("click",function(e){S()})):(n=y+"\n"+E,(t=document.createElement("button")).style.width="200px",t.style.height="30px",t.style.alignSelf="center",t.title=n,t.id="reportConcernClientMenuBtn",t.innerHTML='<img src="images/reportconcern.png" style="width:23px; height 23px; margin-top:0px;"/>',document.getElementById("toolbarUIButtonsContainer").appendChild(t),null!=(t=document.getElementById("reportConcernClientMenuBtn"))&&t.addEventListener("click",function(e){S()})))}function U(e,t){let n=document.getElementById("toolbarUIButtonsContainer");n.classList.remove("toolbarUIButtonsContainerRow"),n.classList.add("toolbarUIButtonsContainerColumn");let o=localStorage.lastEnteredValidCode;!function(){(function(){var e=document.createElement("div");e.innerHTML=l,e.style.color="white",e.style.fontSize="20px",document.getElementById("toolbarUIButtonsContainer").appendChild(e)})(),function(){var e=document.createElement("div");e.id="classCodeInputDivID";var t=document.createElement("input"),n=document.createElement("input"),o=document.createElement("input"),l=document.createElement("input"),a=document.createElement("input"),r=document.createElement("input");e.style.marginBottom="5px",t.style.width="30px",t.style.height="30px",t.style.fontSize="20px",t.style.textAlign="center",t.type="text",t.maxLength=1,t.id="box1",t.style.margin="2px",t.style.resize="none",t.style.lineHeight="1",e.appendChild(t),n.style.width="30px",n.style.height="30px",n.style.fontSize="20px",n.style.textAlign="center",n.type="text",n.maxLength=1,n.id="box2",n.style.margin="2px",n.style.resize="none",n.style.lineHeight="1",e.appendChild(n),o.style.width="30px",o.style.height="30px",o.style.fontSize="20px",o.style.textAlign="center",o.type="text",o.maxLength=1,o.id="box3",o.style.margin="2px",o.style.resize="none",o.style.lineHeight="1",e.appendChild(o),l.style.width="30px",l.style.height="30px",l.style.fontSize="20px",l.style.textAlign="center",l.type="text",l.maxLength=1,l.id="box4",l.style.margin="2px",l.style.resize="none",l.style.lineHeight="1",e.appendChild(l),a.style.width="30px",a.style.height="30px",a.style.fontSize="20px",a.style.textAlign="center",a.type="text",a.maxLength=1,a.id="box5",a.style.margin="2px",a.style.resize="none",a.style.lineHeight="1",e.appendChild(a),r.style.width="30px",r.style.height="30px",r.style.fontSize="20px",r.style.textAlign="center",r.type="text",r.maxLength=1,r.id="box6",r.style.margin="2px",r.style.resize="none",r.style.lineHeight="1",e.appendChild(r),document.getElementById("toolbarUIButtonsContainer").appendChild(e),function(e){let t=document.getElementById("box1"),n=document.getElementById("box2"),o=document.getElementById("box3"),l=document.getElementById("box4"),a=document.getElementById("box5"),r=document.getElementById("box6"),c=!1;e.addEventListener("paste",function(t){let e=(t.clipboardData||window.clipboardData).getData("text");var n;1<e.length?(data=e.split(""),n=this.childNodes,i=0,n.forEach(function(e){id=parseInt(e.id.split("box")[1]),currentid=parseInt(t.srcElement.id.split("box")[1]),W(data[i])&&null!=data[i]&&id>=currentid&&(e.value=data[i].toUpperCase(),i++)}),setTimeout(function(){0==W(t.srcElement.value)&&(t.srcElement.value="")},1),6==data.length&&r.focus(),c=!0,setTimeout(function(){c=!1},800)):(setTimeout(function(){0==W(e.split("")[0])?0==W(t.target.value)&&(t.srcElement.value=""):t.srcElement.value=e.split("")[0].toUpperCase()},1),c=!0,setTimeout(function(){c=!1},1500))}),t.addEventListener("keyup",function(e){W(e.key)&&1==e.key.length&&1!=e.ctrlKey&&0==c?(t.value=e.key.toUpperCase(),n.focus()):"Backspace"==e.key&&(t.value="",t.focus())}),n.addEventListener("keyup",function(e){W(e.key)&&1==e.key.length&&1!=e.ctrlKey&&0==c?(n.value=e.key.toUpperCase(),o.focus()):"Backspace"==e.key&&(n.value="",t.focus())}),o.addEventListener("keyup",function(e){W(e.key)&&1==e.key.length&&1!=e.ctrlKey&&0==c?(o.value=e.key.toUpperCase(),l.focus()):"Backspace"==e.key&&(o.value="",n.focus())}),l.addEventListener("keyup",function(e){W(e.key)&&1==e.key.length&&1!=e.ctrlKey&&0==c?(l.value=e.key.toUpperCase(),a.focus()):"Backspace"==e.key&&(l.value="",o.focus())}),a.addEventListener("keyup",function(e){W(e.key)&&1==e.key.length&&1!=e.ctrlKey&&0==c?(a.value=e.key.toUpperCase(),r.focus()):"Backspace"==e.key&&(a.value="",l.focus())}),r.addEventListener("keyup",function(e){W(e.key)&&1==e.key.length&&1!=e.ctrlKey&&0==c?r.value=e.key.toUpperCase():"Backspace"==e.key&&(r.value="",a.focus())})}(e),function(){let e=document.getElementById("box1"),t=document.getElementById("box2"),n=document.getElementById("box3"),o=document.getElementById("box4"),l=document.getElementById("box5"),a=document.getElementById("box6");e.addEventListener("keypress",function(e){V(e)}),t.addEventListener("keypress",function(e){V(e)}),n.addEventListener("keypress",function(e){V(e)}),o.addEventListener("keypress",function(e){V(e)}),l.addEventListener("keypress",function(e){V(e)}),a.addEventListener("keypress",function(e){V(e)})}()}();var e=document.createElement("div"),t=document.createElement("button");t.style.width="200px",t.id="joinBtn",t.innerHTML=c,t.style.marginBottom="5px",e.appendChild(t),document.getElementById("toolbarUIButtonsContainer").appendChild(e),function(){var e=document.createElement("div");e.id="classCodeStatus",e.appendChild(document.createTextNode(" ")),document.getElementById("toolbarUIButtonsContainer").appendChild(e)}()}(),box1.value=null!=o&&"undefined"!=o?o.split("")[0]:"",box2.value=null!=o&&"undefined"!=o?o.split("")[1]:"",box3.value=null!=o&&"undefined"!=o?o.split("")[2]:"",box4.value=null!=o&&"undefined"!=o?o.split("")[3]:"",box5.value=null!=o&&"undefined"!=o?o.split("")[4]:"",box6.value=null!=o&&"undefined"!=o?o.split("")[5]:"",1==t&&R(e)}function R(e){var t=document.getElementById("classCodeStatus");t.style.textAlign="center",e?(t.style.color="black",t.innerHTML=a):(t.style.color="red",t.innerHTML=o),t.style.marginTop="10px",joinBtn=document.getElementById("joinBtn")}function M(){var e=localStorage.getItem("teacherName"),t=localStorage.getItem("lessonTitle");let n=document.getElementById("teacherContainer");n.innerHTML=e;let o=document.getElementById("titleContainer");o.innerHTML=t}function D(){var e=localStorage.getItem("connectedtext"),t=localStorage.getItem("isConnectedTextSet"),n=localStorage.getItem("viewedtext"),o=localStorage.getItem("isViewedTextSet");let l=document.getElementById("connectionStatusInformation");1==localStorage.isWatching&&"true"==o?l.innerHTML=n:0==localStorage.isWatching&&"true"==t&&(l.innerHTML=e)}function j(){var e,t;"true"==localStorage.showInernetObjectiveUI&&(e=document.createElement("div"),(t=document.createElement("img")).style.width="22px",t.style.height="40px",t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",t.classList.add("studentUIToolbar","img_chat"),t.title=d+"\n"+h,t.id="chatBtn",e.appendChild(t),document.getElementById("toolbarUIButtonsContainer").appendChild(e))}function z(){var e,t;"true"==localStorage.showInernetObjectiveUI&&(e=document.createElement("div"),(t=document.createElement("img")).style.width="22px",t.style.height="40px",t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",t.classList.add("studentUIToolbar","img_helprequest"),t.title=u+"\n"+I,t.id="helpBtn",e.appendChild(t),document.getElementById("toolbarUIButtonsContainer").appendChild(e))}function O(){var e,t;"true"==localStorage.showInernetObjectiveUI&&(e=document.createElement("div"),(t=document.createElement("img")).style.width="22px",t.style.height="40px",t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",t.classList.add("studentUIToolbar","img_internet"),t.title=g+"\n"+x,t.id="internetBtn",e.appendChild(t),document.getElementById("toolbarUIButtonsContainer").appendChild(e))}function q(){var e,t;"true"==localStorage.showInernetObjectiveUI&&(e=document.createElement("div"),(t=document.createElement("img")).style.width="22px",t.style.height="40px",t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",t.classList.add("studentUIToolbar","img_objectives"),t.title=p+"\n"+B,t.id="objectiveBtn",e.appendChild(t),document.getElementById("toolbarUIButtonsContainer").appendChild(e))}function P(){var e,t;"true"==localStorage.isSafeguardingResourcesEnabled&&null!=localStorage.faviconArray&&(t=document.createElement("div"),(e=document.createElement("img")).style.width="10px",e.style.height="25px",e.style.cursor="pointer","true"==T&&(e.style.marginRight="8px"),e.src="images/safeguardingresources.png",e.title=m+"\n"+f,e.id="safeguardingResourcesBtn",t.appendChild(e),document.getElementById("supportToolIconContainer").appendChild(t),null!=(t=document.getElementById("safeguardingResourcesBtn"))&&t.addEventListener("click",function(e){v()}))}function N(){document.getElementById("copyrightText").innerHTML=localStorage.copyright+"<br> ("+chrome.runtime.getManifest().version_name+")"}function _(){document.getElementById("copyrightText").style.marginTop="20px"}function V(e){if(W(String.fromCharCode(e.charCode||e.which)))return 1;e.preventDefault()}function W(e){return!!new RegExp("^[a-zA-Z0-9]+$").test(e)}!function(){localStorage.getItem("chatBtnTxt"),l=localStorage.getItem("classCodeLabel"),c=localStorage.getItem("joinClassBtnTxt"),s=localStorage.getItem("cancelJoinClassBtnTxt"),localStorage.getItem("helpRequestBtnTxt"),a=localStorage.getItem("validClassCodeText"),o=localStorage.getItem("invalidClassCodeText"),connectionStatusValue=localStorage.getItem("connectionStatusValue"),d=localStorage.getItem("chatBtnTxtToolTip"),u=localStorage.getItem("helpBtnTxtToolTip"),g=localStorage.getItem("internetBtnTextToolTip"),p=localStorage.getItem("objectivesBtnTextToolTip"),m=localStorage.getItem("safeguardingResourcesBtnTextToolTip"),y=localStorage.getItem("reportConcernBtnTextToolTip"),h=localStorage.getItem("chatBtnTxtToolTipDesc"),I=localStorage.getItem("helpBtnTxtToolTipDesc"),x=localStorage.getItem("internetBtnTextToolTipDesc"),B=localStorage.getItem("objectivesBtnTextToolTipDesc"),f=localStorage.getItem("safeguardingResourcesBtnTextToolTipDesc"),E=localStorage.getItem("reportConcernBtnTextToolTipDesc");let e=document.getElementById("toolbarUIButtonsContainer");e.classList.remove("toolbarUIButtonsContainerColumn"),e.classList.add("toolbarUIButtonsContainerRow");var t=localStorage.connectionState;"connected_TUTOR"==t?"0"==localStorage.disableChat&&"0"===localStorage.disableHelpRequest&&"true"===localStorage.getItem("canEnableHelpRequestChatIfSet")?(q(),O(),P(),j(),z(),H(!0),M(),D(),w(),N(),k()):"1"==localStorage.disableChat&&"0"===localStorage.disableHelpRequest&&"true"===localStorage.getItem("canEnableHelpRequestChatIfSet")?(q(),O(),P(),z(),H(!0),M(),D(),w(),N(),k()):"0"==localStorage.disableChat&&"1"===localStorage.disableHelpRequest&&"true"===localStorage.getItem("canEnableHelpRequestChatIfSet")?(q(),O(),P(),j(),H(!0),M(),D(),w(),N(),k()):"1"==localStorage.disableChat&&"1"===localStorage.disableHelpRequest&&"true"===localStorage.getItem("canEnableHelpRequestChatIfSet")&&(q(),O(),P(),M(),D(),H(!0),w(),N(),k()):"connected_NCS"==t?(document.getElementById("supportToolIconContainer").style.marginTop="20px",1==("20"!=(t=localStorage.getItem("cloudState"))&&"18"!=t&&"21"!=t)&&"true"!=localStorage.removeClassCodeUI&&("1"==localStorage.classcode||"undefined"==localStorage.classcode)||"true"==localStorage.joiningClassInProgress?("true"==localStorage.joiningClassInProgress?(U(!0,!0),document.getElementById("joinBtn").innerHTML=s):U(!1,!1),N(),P(),k(),_(),null!=(t=document.getElementById("joinBtn"))&&t.addEventListener("click",function(e){var t=e.target,n=document.getElementById("box1"),o=document.getElementById("box2"),l=document.getElementById("box3"),a=document.getElementById("box4"),i=document.getElementById("box5"),e=document.getElementById("box6"),i=n.value+o.value+l.value+a.value+i.value+e.value;localStorage.inputtedClassCode=i;e=document.getElementById("classCodeStatus");if(""!==i&&6==i.length)if(""!=e.innerHTML&&"&nbsp;"!=e.innerHTML)t.innerHTML=c,e.innerHTML="",e.appendChild(document.createTextNode(" ")),localStorage.joinClassInitiated=!1,localStorage.joiningClassInProgress=!1,r.cancelJoinClass();else{t.innerHTML=s;let e=/^[a-zA-Z0-9]{6}$/;e.test(i)&&b(i)}})):(w(),N(),P(),k(),_()),H(!1)):(w(),N(),P(),k(),_(),H()),chrome.runtime.onMessage.addListener(function(e,t,n){"closeRemoveClassCodeUI"==e.text&&(localStorage.joiningClassInProgress=!1,window.close())})}();t=document.getElementById("helpBtn");null!=t&&t.addEventListener("click",function(e){chrome.runtime.sendMessage({createWindow:!0,windowData:{url:"helprequest.html",focused:!0,type:"popup",width:500,height:440,left:screen.width/2-250,top:screen.height/2-220}},function(){})});t=document.getElementById("chatBtn");null!=t&&t.addEventListener("click",function(e){r.startChat()});t=document.getElementById("objectiveBtn");null!=t&&t.addEventListener("click",function(e){chrome.runtime.sendMessage({createWindow:!0,windowData:{url:"lessonObjectives.html",focused:!0,type:"popup",width:500,height:440,left:screen.width/2-250,top:screen.height/2-220}},function(){})});t=document.getElementById("internetBtn");null!=t&&t.addEventListener("click",function(e){"1"==localStorage.OpenBrowser?window.open("https://www.google.com"):"2"==localStorage.OpenBrowser&&window.open(chrome.runtime.getURL("ApprovedWebList.htm"))});t=document.getElementById("safeguardingResourcesBtn");null!=t&&t.addEventListener("click",function(e){v()});t=document.getElementById("reportConcernBtn");null!=t&&t.addEventListener("click",function(e){S()});t=document.getElementById("reportConcernClientMenuBtn");return null!=t&&t.addEventListener("click",function(e){(null==A||A+2e3<e.timeStamp)&&(A=e.timeStamp,S())}),window.document.body.style.backgroundColor=localStorage.customBackgroundColour,{}});