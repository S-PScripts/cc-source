!function(e){"function"==typeof define&&define.amd?define(["background/thumb/config","lib/batch"],e):"object"==typeof exports&&(module.exports=e(require("background/thumb/config"),require("lib/batch")))}(function(e,t){var n=document.createElement("canvas"),i=document.createElement("video"),o=void 0,r={width:void 0,height:void 0},s=!1,c=t.squash(t.token.desktopStream,8e3);function a(){return new Promise(function(n){s||e.getConfig().then(d).then(e=>{if(""==e.video.mandatory.chromeMediaSourceId)return a();var t;t=e,new Promise((i,o)=>{chrome.runtime.sendMessage({getMediaDevices:!0,settings:t}),chrome.runtime.onMessage.addListener((e,t,n)=>{1==e.getMediaDevicesResponse&&(1==e.success?i(e.dimensions):o(e.e))})}).then(e=>{n(e)})})})}function u(e={}){let{width:t,height:n}=r&&r.width?r:e;return new Promise(function(e){t&&e({width:t,height:n})})}function d(e){const{sourceType:t,constraints:n}=e;let o={...n};return new Promise(i=>{chrome.runtime.sendMessage({chooseDesktopMedia:!0,sourceType:t}),chrome.runtime.onMessage.addListener(function(e,t,n){1==e.chooseDesktopMediaResponse&&(o={...o,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e.streamId}},audio:e.options.canRequestAudioTrack},i(o))})})}return{getCanvas:function(){return n},getVideo:function(){return i},getStream:function(){},getDimensions:u,confirmStream:function(e){return new Promise(function(t){o&&(null==localStorage.isStreamActive||"false"==localStorage.isStreamActive?c().then(a).then(e=>t(e)):u().then(t))})},setDisplaySize:function(e,t){e&&t&&(r.width=e,r.height=t,n.width=e,n.height=t)},enable:function(){o=!0,localStorage.established=!0},disable:function(){o=!1,localStorage.established=!1},isActive:function(){return"true"==localStorage.isStreamActive},silence:function(e){s=!!e},initialiseStream:a,isEstablished:function(){return localStorage.established}}});