!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?module.exports=r():(e.ns=e.ns||{content:{}},e.ns.content.webFilter=r())}(this,function(){var n={filter:{redirect:[],approved:[],restricted:[]}};function t(r,e){if(e.subURL){if(e.subURL.block)if(0<e.subURL.block.filter(function(e){if(0<r.url.indexOf(e)||"."==e)return!0}).length){if(e.timeIgnore)if(0<e.timeIgnore.filter(i).length)return r.matched=!0,r;return r.matched=!0,r.value=n.filter.redirect,r}if(e.subURL.allow)if(0<e.subURL.allow.filter(function(e){return 0<url.indexOf(e)}).length)return r.matched=!0,r}else{if(!e.timeIgnore)return r.matched=!0,r.value=n.filter.redirect,r;if(0<e.timeIgnore.filter(i).length)return r.matched=!0,r}return r}function i(e){var r=new Date;return e.from<r&&e.to>r}function u(e,r,t){switch(url=r.match(/[\{\[](.+)[\]\}]/),r[0]){case"[":e.block.push(url[1]);break;case"{":e.allow.push(url[1])}return e}function l(e){f=e.match(/([0-9]{2})([0-9])\-([0-9]{2})([0-9])/);var r=new Date;r.setHours(f[1]),r.setMinutes(6*f[2]),r.setSeconds(0);e=new Date;return e.setHours(f[3]),e.setMinutes(6*f[4]),e.setSeconds(0),{from:r,to:e}}return{configure:function(e){var r,t=null!=e?e.filter.split("\r\n"):null,i=[];for(r in t)switch(t[r]){case"PF":break;case"redirect:":n.filter.redirect=t[++r],i=[];break;case"include:":n.filter.approved=[],i=n.filter.approved;break;case"exclude:":n.filter.restricted=[],i=n.filter.restricted;break;default:i.push(function(e){e.replace("{","[").replace("}","]");var r={raw:e,url:void 0,timeIgnore:void 0,subURL:void 0};e.length&&(!(t=e.match(/\"(.+)\"(.+?)((?:[0-9]{3}\-[0-9]{3},*){1,})/))||t[2].match(/[0-9]{3}-[0-9]{3}/)?(t=e.match(/(.+?)([0-9,-]+)*$/))&&(r.url=t[1],r.timeIgnore=t[2]):(r.url=t[1],r.subURL=t[2],r.timeIgnore=t[3]));{var t;t&&t[1]&&(t=r.url.match(/([^\[]+)([\[].+[\]])*/),r.url=t[1].replace(/\"?([^\"]+)\"?/,"$1").replace("*","."),r.timeIgnore&&(r.timeIgnore=r.timeIgnore.split(",").map(l)),!r.subURL||(t=r.subURL.match(/([\{\[].+?[\]\}])/g))&&(r.subURL=t.reduce(u,{block:[],allow:[]})))}return r}(t[r]))}},request:function(r){if(r){if(r===n.filter.redirect)return;var e=n.filter.restricted.filter(function(e){return e.url&&0<r.indexOf(e.url)});if(e){e=e.reduce(t,{matched:!1,value:void 0,url:r});if(e.matched)return e.value}n.filter.approved.map(function(e){console.log(r.indexOf(e.url),r,e.url)}),n.filter.approved.filter(function(e){if(1<r.indexOf(e.url)&&(e.timeIgnore&&0<e.timeIgnore.filter(i).length))return n.filter.redirect})}}}});