!function(e){"function"==typeof define&&define.amd?define(["phrase/processor","phrase/tgMatch","logger","background/esafety","background/messageQueue","modules/ciccore","modules/cicregistration"],e):"object"==typeof expociccorerts&&(module.exports=e(require("phrase/processor"),require("phrase/tgMatch"),require("logger"),require("background/esafety"),require("background/messageQueue"),require("modules/ciccore"),require("modules/cicregistration")))}(function(t,s,o,n,c,l,i){function u(e){var r=t.preprocess(e),e=(r=r.replace("google","")).split(" ").filter(e=>"google"!==e).map(m).filter(e=>e),r=s.match(r);return r=0==r.length&&e.length?e:r}function a(e,r){var t,o,n,c,a=u(e);0<a.length&&a[0].text&&([].push(a[0].text),(c=function(r,e,t=.8){const o=g(r),n=g(e),c=o.length;for(let e=0;e<=n.length-c;e++){var a=n.slice(e,e+c).join(" "),s=function(e,r){var t=p(h(e)),o=p(h(r));let n=0;for(const c in t)o[c]&&(n+=Math.min(t[c],o[c]));e=Object.values(t).reduce((e,r)=>e+r,0),r=Object.values(o).reduce((e,r)=>e+r,0);return 2*n/(e+r)}(r,a);if(t<=s)return{match:!0,score:s,textSegment:a}}return{match:!1,score:0,textSegment:null}}(a[0].text,e,s.conf.threshold)).match&&0<c.score&&(t=(new Date).getTime(),o=localStorage.getItem("prevTime"),n=null!=a[0]?a[0].text:"",c=localStorage.getItem("prevPhrase"),(a.length&&"true"==localStorage.phrasematchEnabled&&l.core.isTriggerable(r.phraseSource,a,r.url,i)&&(null==o||null==c||null==c)||a.length&&"true"==localStorage.phrasematchEnabled&&l.core.isTriggerable(r.phraseSource,a,r.url,i)&&(c!=n||4!=r.phraseSource&&t-o<5e3||5e3<t-o))&&(localStorage.setItem("prevTime",t),localStorage.setItem("prevPhrase",n),f(e,a,r))))}function g(e){return e.toLowerCase().replace(/[^a-z0-9\s]+/g,"").split(/\s+/).filter(Boolean)}function h(e){const r="  "+e.toLowerCase()+"  ",t=[];for(let e=0;e<r.length-2;e++)t.push(r.slice(e,e+3));return t}function p(e){const r={};for(const t of e)r[t]=(r[t]||0)+1;return r}function f(e,r,t){n.getPhraseMatch(e,r,t).then(function(e){"1"!=localStorage.expired&&null!=localStorage.expired&&c.priority.enqueue(e)})}function m(e){var r=t.phrases[e];if(r)return o.info("MATCH",e),{text:r[1],detail:r[0],confidence:100}}function r(){t.reset()}return{config:{},configure:function(e){r(),n.configure(e),e&&e.LanguageFiles&&t.importLanguageList(e.LanguageFiles.split(";")),e&&e.phraselist&&t.importCustomPhraseList(e.phraselist),e&&e.hasOwnProperty("Threshold")&&(o.info("Setting phrasematch threshold to "+e.Threshold+"%"),s.conf.threshold=e.Threshold/100)},match:u,process:a,processTab:function(e,r){return a(decodeURIComponent(e).replace(/[a-z]+:\/\//,"").replace(/[\+\=\&]/g," "),r)},reset:r}});