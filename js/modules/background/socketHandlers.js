!function(e){"function"==typeof define&&define.amd?define(["background/subscription","modules/extension","on/lifecycle","comms.commands","comms.websocket","comms.nc","student","disconnect","models/login","modules/ciccore","background/storageSync","modules/cicregistration"],e):"object"==typeof exports&&(module.exports=e(require("background/subscription"),require("modules/extension"),require("on/lifecycle"),require("comms.commands"),require("comms.websocket"),require("comms.nc"),require("student"),require("disconnect"),require("models/login"),require("modules/ciccore"),require("background/storageSync"),require("modules/cicregistration")))}(function(e,t,o,n,r,a,s,c,i,l,d,u){function g(){let e=new Date;e.setMilliseconds(0);var t=e.getTime();i.registerLogin(t),localStorage.loginTime=t,localStorage.setItem("isCloseCalled",!1),l.core.startTimeStampTimer()}return{message:function(e){var t;e.data instanceof ArrayBuffer?(t=new Uint8Array(e.data),n.match(n.signatures.prefix,t)?n.interpret.binary(t):(o.isActive(),a.Process(r.Commands.convertBinaryToString(t,e.data.byteLength)))):"CMD="===(e=atob(e.data)).substr(0,4)?n.interpret.string(e):(o.isActive(),a.Process(e))},error:function(e){chrome.runtime.sendMessage({storeLocal:!0,data:{connectionState:"disconnected"}}),"1"===t.getGWFlag()?t.setGWFlag(2):t.setGWFlag(1),debug(e.data)},open:function(){db.altdebug("85 skthandlers - open"),localStorage.connectionState="connected_NCS",chrome.runtime.sendMessage({storeLocal:!0,data:{connectionState:"connected_NCS"}}),clearTimeout(s.reconnectMode.expiryHandler),o.isActive(),s.reconnectMode.expiryHandler=setTimeout(s.reconnectMode.clear,1e4),s.Opened=!1,"1"===t.getGWFlag()?t.setGWFlag(1):t.setGWFlag(2),o.openHandshake=window.setTimeout(t.handshake,500),chrome.runtime.sendMessage({storeLocal:!0,data:{hasDisconnected:!1}}),null!=localStorage.gatewayAddress&&"undefined"!=localStorage.gatewayAddress&&(localStorage.allowAvailableStatusAction=!0),"null"!=localStorage.policiesUnsent&&""!=localStorage.policiesUnsent&&null!=localStorage.policiesUnsent&&u.cic.resendUnsentAUPSignatures(),d.get(["storedTimes"]).then(function(e){"false"==localStorage.isCloseCalled||null==localStorage.isCloseCalled&&"false"==localStorage.regDevice?e.storedTimes.timestamp?i.loadArchivedLogins(e.storedTimes.timestamp).then(g):l.core.startTimeStampTimer():(g(),localStorage.regDevice=!1),localStorage.isCloseCalled=!1}),require(["background/websocket"],function(e){e.updatewebdatatimer()}),require(["background/websocket"],function(e){e.updateLoginTimer()})},close:function(){db.altdebug("129 skthandlers - close"),s.Connections={},localStorage.loginInitiated=!1,localStorage.lastEnteredValidCode=void 0,localStorage.internetStatus=1,chrome.runtime.sendMessage({storeLocal:!0,data:{connectionState:"disconnected"}}),debug("Socket(HB: "+gHeartBeat.event+").onclose: (RS:"+this.readyState+")"),c.reset(!0,{code:1e3,message:"disconnect"}),s.Opened=!1,NSLibrary.Client.webRTCTutorWindowed.removeWebRTCTutorWindowed(),NSLibrary.Client.webRTCTutorFullScreen.removeWebRTCTutorFullScreen(),chrome.runtime.sendMessage({lessonObj:!0}),localStorage.setItem("isCloseCalled",!0),i.registerLogout()}}});