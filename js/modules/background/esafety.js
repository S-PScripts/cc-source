!function(e){"function"==typeof define&&define.amd?define(["models/useridentity","background/thumbnail","modules/altdebug"],e):"object"==typeof exports&&(module.exports=e(require("models/useridentity"),require("background/thumbnail"),require("modules/altdebug")))}(function(u,a){var h={actions:[0,0,0,4,12,0]};let o,n;var l=4,d=8;function m(t,e,r){a.getThumbnail({height:e.tab.height,width:e.tab.width},e.tab).then(function(e){1==n&&"true"==localStorage.isDesktopCaptureOpen?t.phrasematch.screenshot={data:o}:t.phrasematch.screenshot={data:e},r(t)})}function g(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}return chrome.runtime.onMessage.addListener(function(e,t,r){return 1==e.sendDesktopImageDataURLForEsafety&&(o=e.desktopImageDataURL),!0}),chrome.runtime.onMessage.addListener(function(e,t,r){1==e.setUseDesktopImageDataURLEsafety&&(n=e.useDesktopImageDataURL)}),{getPhraseMatch:function(n,s,c){return new Promise(function(e,t){var r=s.map(function(e){if(null!=e.detail[1])return{confidence:e.confidence,matchedPhrase:e.text,category:e.detail[0],priority:e.detail[1]}}),a={phrasematch:{phrase:function(e,t,r){let a=0,i=e.length;70<e.length&&(0<r-25&&(a=r-25),r+t.length+25<e.length&&(i=r+t.length+25));return e.substr(a,i)}(n,s[0].text,s[0].positionIndex),executable:c.url.match([".+://[^/]+"])[0],user:u.get().user,userdomain:"Chrome",time:new Date,phrasesource:c.phraseSource,className:"true"==localStorage.connectedToTutor&&null!=localStorage.className?localStorage.className:null,teacher:"true"==localStorage.connectedToTutor&&null!=localStorage.teacher?localStorage.teacher:null,results:r}},o=r.reduce(function(e,t){return Math.max(e,null==t?0:t.priority)},0);if(h.actions[o]==(l|d)){for(localStorage.phraseTriggeredWithVideoSet=!0,localStorage.phraseSource=c.phraseSource,i=0;i<r.length;i++)if(null!=a.phrasematch.results[i]&&(a.phrasematch.results[i].id=g(),a.phrasematch.results[i].hasVideo=h.actions[r[i].priority]==(l|d),1==a.phrasematch.results[i].hasVideo)){let e=JSON.parse(localStorage.phraseMatchIDs);e.push(a.phrasematch.results[i].id),localStorage.phraseMatchIDs=JSON.stringify(e)}4==c.phraseSource?setTimeout(function(){m(a,c,e)},3e3):m(a,c,e)}else if(h.actions[o]==l){for(i=0;i<r.length;i++)null!=a.phrasematch.results[i]&&(a.phrasematch.results[i].id=g(),a.phrasematch.results[i].hasVideo=!1);4==c.phraseSource?setTimeout(function(){m(a,c,e)},3e3):m(a,c,e)}else{for(i=0;i<r.length;i++)null!=a.phrasematch.results[i]&&(a.phrasematch.results[i].id=g(),a.phrasematch.results[i].hasVideo=!1);e(a)}})},getResult:function(r){return new Promise(function(e,t){e([{confidence:r.confidence,matchedPhrase:r.matchedPhrase,category:r.category,priority:r.priority,screenshot:r.screenshot,data:r.data}])})},config:h,configure:function(e){e&&(h.actions[1]=e.LowPriorityAction?parseInt(e.LowPriorityAction):0,h.actions[2]=e.MediumPriorityAction?parseInt(e.MediumPriorityAction):0,h.actions[3]=e.HighPriorityAction?parseInt(e.HighPriorityAction):4,h.actions[4]=e.UrgentPriorityAction?parseInt(e.UrgentPriorityAction):12)}}});