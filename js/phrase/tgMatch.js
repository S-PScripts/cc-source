!function(t){"function"==typeof define&&define.amd?define("phrase/tgMatch",["logger"],t):"object"==typeof exports&&(module.exports=t(require("logger")))}(function(s){var d=[],g={threshold:.9};function h(t){tg=[],phrase=" ".concat(t," ");for(var e=0;e<phrase.length-2;e++)tg.push(phrase.substr(e,3));return tg}function e(t){return n({text:t[0],map:[],matchData:t[1],mappedTrigrams:void 0,textUntouched:t[2]},d)}function n(e,t){var n;1!=e.text.length&&(n=h(e.text).sort().map(function(t){return[t.charCodeAt(0),t.substr(1),e]}),(e.mappedTrigrams=n).reduce(m,e.map),t&&n.reduce(m,t))}function m(t,e){var n,r=t[e[0]];return r?(n=r[e[1]])?n.find(function(t){return t.text===e[2].text})||n.push(e[2]):r[e[1]]=[e[2]]:(t[e[0]]={},t[e[0]][e[1]]=[e[2]]),t}return{trigram:h,tokenify:n,conf:g,match:function(r){var t,e={text:r},n=[],o=h(r).sort().map(function(t){return[t.charCodeAt(0),t.substr(1),e]});for(t in o){var i=o[t],a=d[i[0]];if(a&&(tgSegment=a[i[1]],tgSegment))for(var u in tgSegment)-1===n.indexOf(tgSegment[u])&&n.push(tgSegment[u])}var c=[];o.reduce(m,c);var f=n.map(function(t){var e=t.mappedTrigrams.reduce(function(t,e){var n=c[e[0]];return n&&n[e[1]]&&t++,t},0)/t.mappedTrigrams.length;if(g.threshold<=e){s.debug(e,t.text,t);var n=function t(e,n,r){const o=e.split(" ");const i=n.split(" ");let a=0;let u=[];let c=r;for(p=0;p<o.length;p++){for(;c<i.length;){if(-1<o[p].toLowerCase().indexOf(i[c].toLowerCase())){if(a+=1,u.length<1){u.push(c);break}if(c>u[u.length-1]){u.push(c);break}}c+=1}for(q=0;q+1<u.length;q++)if(u[q+1]-u[q]!=1)return t(e,n,c-1);if(0==a)return{acceptResult:!1}}if(1<u.length)for(q=0;q+1<u.length;q++)if(u[q+1]-u[q]!=1)return{acceptResult:!1};let f="";for(c=0;c<u.length;c++)f=f+i[u[c]]+" ";return{positionIndex:n.toLowerCase().indexOf(f.trim().toLowerCase()),acceptResult:!0}}(t.textUntouched,r,0);if(1==n.acceptResult)return{confidence:Math.round(100*e),text:t.textUntouched,detail:t.matchData,positionIndex:n.positionIndex}}}).reduce(function(t,e){return e&&t.push(e),t},[]).sort(function(t,e){return e.confidence-t.confidence}).sort(function(t,e){return e.detail[1]-t.detail[1]});return f.length?[f[0]]:[]},buildGrid:function(t){t.map(e)},reset:function(t){t?t.map(function(t){t={text:t,map:[],matchData:void 0,mappedTrigrams:void 0};return n(t),t.mappedTrigrams}).map(function(e){var t,n=d[e[0]];n&&n[e[1]]&&(t=n[e[1]])&&(!(n=t.find(function(t){return t.text===e[2].text}))||-1<(n=t.indexOf(n))&&t.splice(n,1))}):d=[]}}});