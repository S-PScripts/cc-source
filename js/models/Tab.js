!function(e){"function"==typeof define&&define.amd?define(["student","models/TabData","device","plugin","modules/debug"],e):"object"==typeof exports&&(module.exports=e(require("student"),require("models/TabData"),require("device"),require("plugin"),require("modules/debug")))}(function(c,o,a,r,i){var l,s;class u{static PollActive(){chrome.runtime.sendMessage({queryTabs:!0,tabData:{active:!0}},function(e){u.getDetails(e)})}pollSelectedTab(){u.PollActive()}static Make(e,t,r){return n(chrome.runtime.getURL(e),t,r)}static MakeTutorWebRTC(e,t){return n(e,t)}static MakeExternal(e){return n(e,e)}static Update(t,e,r){var n;e.url&&"chrome://newtab/"!=e.url&&e.url!=chrome.runtime.getURL("desktopCapture.html")?(localStorage.changedURL=e.url,(n=u.mustFilter(localStorage.changedURL))?chrome.runtime.sendMessage({tabsUpdate:!0,tabID:t,tabData:{url:n}}):(chrome.runtime.sendMessage({getTab:!0,tabID:t},function(e){u.getDetails(e)}),require(["modules/cicregistration"],function(e){!e.cic.shouldBlockSiteIternetRestrictions(localStorage.changedURL)||0!=localStorage.connectionCount&&null!=localStorage.connectionCount||"18"!=localStorage.cloudState&&chrome.runtime.sendMessage({tabsUpdate:!0,tabID:t,tabData:{url:chrome.runtime.getURL("weblock.html")}})}))):"complete"!=e.status||"chrome://newtab/"==r.url||null!=localStorage.changedURL&&null!=localStorage.changedURL&&"null"!=localStorage.changedURL||((n=u.mustFilter(r.url))?chrome.runtime.sendMessage({tabsUpdate:!0,tabID:r.id,tabData:{url:n}}):(chrome.runtime.sendMessage({getTab:!0,tabID:t},function(e){u.getDetails(e)}),require(["modules/cicregistration"],function(e){r.url&&e.cic.shouldBlockSiteIternetRestrictions(r.url)&&(0==localStorage.connectionCount||null==localStorage.connectionCount)&&"18"!=localStorage.cloudState&&chrome.runtime.sendMessage({tabsUpdate:!0,tabID:t,tabData:{url:chrome.runtime.getURL("weblock.html")}})})))}static mustFilter(e){var t,r;if(0<=(e="https://"==(e="http://"==e.substr(0,7)?e.substr(7):e).substr(0,8)?e.substr(8):e).indexOf(chrome.runtime.getURL("")))return null;if("chrome://"==e.substr(0,9))return null;if("chrome-devtools://"==e.substr(0,18))return null;var n,o,a=null,i=null==localStorage.unlocktimeout||"undefined"==localStorage.unlocktimeout||"0"==localStorage.unlocktimeout||0!=Object.keys(c.Connections).length||"false"!=localStorage.offlineTimedOut||"undefined"==localStorage.offlineConnection?c.Connections:JSON.parse(localStorage.offlineConnection),l=0;for(o in i)if(l+=1,i[o].webpoll){var s=i[o];if("ftp://"==e.substr(0,6)&&0!=(1&s.webflag))return localStorage.connectionsCount=l,chrome.runtime.getURL("weblock.html");for(n=0;n<s.excludes.length;++n){if("*"==s.excludes[n])return localStorage.connectionsCount=l,s.redirect;if('"'==s.excludes[n].charAt(0)){if(2==(t=g(e,s.excludes[n]))||1==t)return localStorage.connectionsCount=l,s.redirect}else if(r=e.substr(0,e.indexOf("/")),s.excludes[n]==r)return localStorage.connectionsCount=l,s.redirect}for(a=s.redirect,n=0;n<s.includes.length;++n)if("*"==s.includes[n])a=null;else if('"'==s.includes[n].charAt(0)){if(2==(t=g(e,s.includes[n]))||0===t)return s.redirect;if(3==t||1==t)return a=null,!1}else r=e.substr(0,e.indexOf("/")),s.includes[n]==r&&(a=null)}if(tcpConnected){if("ftp://"==e.substr(0,6)&&0!=(1&gWebflag))return chrome.runtime.getURL("weblock.html");for(n=0;n<gExcludes.length;++n){if("*"==gExcludes[n])return gRedirect;if('"'==gExcludes[n].charAt(0)){if(2==(t=g(e,gExcludes[n])))return gRedirect}else if(r=e.substr(0,e.indexOf("/")),gExcludes[n]==r)return gRedirect}for(a=gRedirect,n=0;n<gIncludes.length;++n)if("*"==gIncludes[n])a=null;else if('"'==gIncludes[n].charAt(0)){if(2==(t=g(e,gIncludes[n])))return gRedirect;if(3==t)return a=null,!1}else r=e.substr(0,e.indexOf("/")),gIncludes[n]==r&&(a=null)}return a}static getDetails(e){if(e&&e[0]){for(var t in l=e[0],s=l.id,c.Connections){var r,n;c.Connections[t].webpoll&&((r=c.Connections[t]).appidlast||(r.force=!0,l.url!=chrome.runtime.getURL("desktopCapture.html")&&o.send(l),r.appidlast=s,r.force=!1),n=r.weburllast==l.url,t=r.webtitlelast==l.title,n&&t||(r.weburllast=l.url,r.webtitlelast=l.title))}l.url!=chrome.runtime.getURL("desktopCapture.html")&&o.send(l)}}static getAllTabsFromOpenWindows(){return new Promise(function(t){chrome.runtime.sendMessage({windowsGetAll:!0,winData:{populate:!0}},function(e){e instanceof Array&&t(e.map(e=>e.tabs).reduce((e,t)=>e.concat(t)))})})}static updateCurrentWebsite(t){return new Promise(function(e){-1<t.id&&chrome.runtime.sendMessage({queryTabs:!0,tabData:{windowId:t.id,active:!0}},function(e){u.getDetails(e)}),e(t)})}static SendData(e){e.url!=chrome.runtime.getURL("desktopCapture.html")&&o.send(e)}static clearId(e){r.webClose("","",e),r.appClose(e);var t=c.TabStore[e];i(t+" Tab Removed"),t&&(c.TabStore[t]=!1,c.TabStore[e]=!1)}static Remove(e){var t=c.TabStore[e];return t&&chrome.runtime.sendMessage({removeTab:!0,tabID:c.TabStore[e],errorMessage:""}),t}static replace(e,t){i("replaceTab:-["+t+"]+["+e+"]"),plugin.appStart(e),this.clearId(t)}static parseWebFilter(e,t){var r=t.indexOf("redirect:\r\n"),n=t.indexOf("include:\r\n"),o=t.indexOf("exclude:"),a="";0<=r&&"http://localhost/weblock.htm"==(a="http://localhost/ApprovedWebList.htm"==(a=t.substring(r+11,n-2))?chrome.runtime.getURL("ApprovedWebList.htm"):a)&&(a=chrome.runtime.getURL("weblock.html"));n=t.substring(n+10,o).toLowerCase(),o=t.substring(o+10).toLowerCase();!function(e,t){let r=e.split("\r\n"),n=t.split("\r\n");localStorage.internetStatus="1",null==n[0].toString().match(/(?:.*?[a-zA-Z0-9]){3}.*/)&&""!=n[0]||("*"==r[0]&&""==n[0]?(localStorage.internetStatus="1",d(1)):""!==n[0]&&-1==n[0].indexOf("localhost")?(localStorage.internetStatus="2",d(2)):""!=r[0]&&-1==n[0].indexOf("localhost")?(localStorage.internetStatus="3",d(3)):(localStorage.internetStatus="4",d(4)))}(n,o),o=o.split("\r\n"),gRedirect=a;e=c.Connections[e];e.webflag=t.charCodeAt(0)-80,e.redirect=a,e.includes=n.split("\r\n"),e.excludes=o,localStorage.offlineConnection=JSON.stringify(c.Connections),tcpConnected&&(gWebflag=t.charCodeAt(0)-80,gRedirect=a,gIncludes=n.split("\r\n"),gExcludes=o),chrome.runtime.sendMessage({queryTabs:!0,tabData:{}},function(e){for(var t in e){t=e[t],t=u.mustFilter(t.url);t&&"18"!=localStorage.cloudState&&chrome.runtime.sendMessage({tabsUpdate:!0,tabID:s,tabData:{url:t}})}})}static filterTabs(){chrome.runtime.sendMessage({queryTabs:!0,tabData:{}},function(e){for(var t in e){t=e[t];u.mustFilter(t.url)&&!t.url.includes("desktopCapture")&&"18"!=localStorage.cloudState&&(0<gRedirect.indexOf("Approved")||c.Connections[0]&&0<c.Connections[0].redirect.indexOf("Approved")?chrome.runtime.sendMessage({tabsUpdate:!0,tabID:t.id,tabData:{url:chrome.runtime.getURL("ApprovedWebList.htm")}}):chrome.runtime.sendMessage({tabsUpdate:!0,tabID:t.id,tabData:{url:chrome.runtime.getURL("weblock.html")}}))}})}}function d(t){setTimeout(function(){require(["modules/ciccore"],function(e){e.core.message.showInternetStatusDialog(t)})},1e3)}function n(r,n,o){return new Promise(function(t){chrome.runtime.sendMessage({createTab:!0,tabData:{url:r}},function(e){1==e.retreiveTabID&&((e=e.tab)?(null!=o?(c.TabStore[e.id]=n+e.id,c.TabStore[n+e.id]=e.id):(c.TabStore[e.id]=n,c.TabStore[n]=e.id),i(n+" created, Display PowerMode"),c.powerMode="display",chrome.runtime.sendMessage({requestKeepAwake:!0,powerMode:c.powerMode}),i(n+" Switch PowerMode system in +90S"),c.powerMode="system",window.setTimeout(a.power.switchMode,9e4),null!=o?(localStorage.tabID=e.id,t({key:n+e.id,tab:e})):t({key:n,tab:e})):(e=chrome.runtime.lastError)&&("No current window"==e.message?chrome.windows.create({url:r},function(e){chrome.runtime.sendMessage({queryTabs:!0,tabData:{windowId:e.id,active:!0}},function(e){e&&e[0]&&(c.TabStore[e[0].id]=n,c.TabStore[n]=e[0].id,c.powerMode="display",chrome.runtime.sendMessage({requestKeepAwake:!0,powerMode:c.powerMode}),i(n+" Switch PowerMode system in +90S"),c.powerMode="system",window.setTimeout(a.power.switchMode,9e4),t({key:n,tab:e[0]}))})}):i("Unable to create tab: "+r)))})})}function g(e,t){var r=t.indexOf('"',1);if(1<r){var n=e.substr(e.indexOf("/")).toLowerCase(),o=t.substring(1,r);if(0<=e.indexOf(o)){for(var a=0,i=!1;"{"==t.charAt(r+1)||"["==t.charAt(r+1);){var i=!0,l=0,s="{"==t.charAt(r+1)?1:-1,c=t.indexOf(1==s?"}":"]",r+2),u=t.substring(r+2,c);n.substr(0,u.length)==u&&(l+=s*u.length,Math.abs(l)>Math.abs(a)&&(a=l)),r=c}return i?0===a?0:0<a?3:2:1}}return-1}return u});