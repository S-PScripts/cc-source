define(["background/storage","models/useridentity"],function(r,a){var o;function t(){return new Promise(function(e,n){var t={osname:"Chrome OS",brand:void 0,model:void 0,manufacturer:void 0,assettag:void 0,serial:void 0,cpuname:void 0,x64:void 0,cpu_count:void 0,ram:void 0,renderer:void 0,colorDepth:void 0,language:navigator.language,refreshRate:void 0,storageFixedTotal:void 0,storageFixed:[],storageRemovable:[],displays:[]};for(var r=new RegExp(/([a-zA-Z]+)\/([0-9.]+) *(\([^)]+\))*/g),a=navigator.userAgent;null!==(uaValues=r.exec(a));)!function(e){switch(e[1]){case"Chrome":t.osver+=" (Chrome "+e[2]+")";break;case"Mozilla":var n=e[3];n&&(os=n.substr(1,n.length-2).split("; "),"X11"===os[0]||"Macintosh"===os[0]?t.osver=os[1]:t.osver=os[0]);break;default:;}}(uaValues);e(t)})}function s(r){return new Promise(function(t,e){r.colorDepth=window.screen.colorDepth,r.videoCard=function(){const e=document.createElement("canvas").getContext("webgl");if(!e)return{error:"no webgl"};var n=e.getExtension("WEBGL_debug_renderer_info");return n?{vendor:e.getParameter(n.UNMASKED_VENDOR_WEBGL),renderer:e.getParameter(n.UNMASKED_RENDERER_WEBGL)}:{error:"no WEBGL_debug_renderer_info"}}(),chrome.runtime.sendMessage({getDisplay:!0},function(e){for(i=0;i<e.length;i++){var n={resolution:e[i].bounds.width+"x"+e[i].bounds.height,name:1==e[i].isPrimary?"Primary "+e[i].name:e[i].name};r.displays.push(n)}t(r)})})}function u(i){return new Promise(function(r,e){chrome.runtime.sendMessage({systemStorage:!0},function(e){for(var n=0,t=0,a=0;a<e.length;a++)if("fixed"==e[a].type){n+=e[a].capacity;let r={capacity:(e[a].capacity/1e9).toFixed(2),id:e[a].id,name:e[a].name,type:e[a].type};chrome.runtime.sendMessage({getAvailableCapacity:!0,id:e[a].id}),chrome.runtime.onMessage.addListener(function(e,n,t){1==e.getAvailableCapacityResult&&(i.storage[e.id].free=e.availableCapacity,r.free=e.availableCapacity,i.storageFixed.push(r))}),i.storageFixed.push(r)}else if("removable"==e[a].type){t+=e[a].capacity;let r={capacity:(e[a].capacity/1e9).toFixed(2),id:e[a].id,name:e[a].name,type:e[a].type};chrome.runtime.sendMessage({getAvailableCapacity:!0,id:e[a].id}),chrome.runtime.onMessage.addListener(function(e,n,t){1==e.getAvailableCapacityResult&&(i.storage[e.id].free=e.availableCapacity,r.free=e.availableCapacity,i.storageRemovable.push(r))}),i.storageRemovable.push(r)}i.storageFixedTotal=(n/1e9).toFixed(2),i.storageRemovableTotal=(t/1e9).toFixed(2),i.storageNumber=e.length,r(i)})})}function c(r){return new Promise(function(t,e){chrome.runtime.sendMessage({getCPUInfo:!0},function(e){var n;r.cpuname=e.modelName,r.x64=e.archName,r.cpu_count=e.numOfProcessors,r.cpu_temperatures=e.temperatures,r.cpuspeed=-1!=(n=e.modelName).indexOf("GHz")?(pos=n.indexOf("GHz"),1e3*parseFloat(n.substr(pos-5,pos+3))):null,r.cpumanufacturer=-1!=(n=e.modelName).indexOf("Intel")?"Intel":-1!=n.indexOf("AMD")?"AMD":-1!=n.indexOf("Celeron")||-1!=n.indexOf("Pentium")?"Intel":null,r.cpumodel=-1!=(e=e.modelName).indexOf("CPU")&&-1!=e.indexOf("@")?e.split("CPU")[1].split("@")[0].trim():null,t(r)})})}function d(t){return new Promise(function(n){chrome.runtime.sendMessage({getMemoryInfo:!0},function(e){t.ram=Math.round(e.capacity/1e9).toFixed(2),n(t)})})}return{hardware:function(n){return new Promise(function(e){e(n?new Promise(function(e){(new t).then(function(t){return new Promise(function(e,n){e(o=t)})}).then(s).then(c).then(d).then(u).then(function(t){return new Promise(function(e,n){t.name=a.get().device,r&&r.set({hardware:t}),e(t)})}).then(e(o))}):new Promise(function(n){(new t).then(function(t){return new Promise(function(e,n){e(o=t)})}).then(s).then(c).then(d).then(u).then(function(e){e.name=a.get().device,r&&r.set({hardware:e}),n(e)})}))})},debug:(new t).then(function(t){return new Promise(function(e,n){e(o=t)})}).then(s).then(c).then(d).then(u).then(function(e){e.name=a.get().device,r&&r.set({hardware:e})}),format:function(n){return new Promise(function(e){e(JSON.stringify({hardware:n}))})},config:{},configure:function(e){}}});