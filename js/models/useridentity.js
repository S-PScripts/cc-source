define(["lib/batch","logger","comms.websocket"],function(e,n,i){var t={user:void 0,device:{long:void 0,short:void 0},userdomain:void 0},s=e.squash(e.token.identityAuth,25e3);e={user:function(){return new Promise(function(o,r){chrome.runtime.sendMessage({getProfileUserInfo:!0}),chrome.runtime.onMessage.addListener(function(e,n,i){1==e.getProfileUserInfoResponse&&(e.email?(t.user=e.email,o(e.email)):s().then(function(){r("no-identity")}))})})},device:function(){return new Promise(function(o,e){chrome.runtime.sendMessage({getDirectoryDeviceId:!0}),chrome.runtime.onMessage.addListener(function(e,n,i){1==e.getDirectoryDeviceIdResponse&&(e.devId?(t.device.long=e.devId,t.device.short=(e=e.devId,c.exec(e).slice(1).reduce(r).split(/([^-])./).reduce(r)),o(t.device)):o(void 0))})})}};function r(e,n){return e+n}const c=new RegExp(/(.+?)-(.+?)-(.+?)-(.+?)-(.+)/);return{get:function(){return t},refresh:e}});