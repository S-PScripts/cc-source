!function(e){"function"==typeof define&&define.amd?define(["comms.nc.protocol","utf8","flag","modules/translate","pubsub","student","background/CLIENT","accept","mouse","chatlib","showlib","models/register","models/Tab","models/survey","modules/image","modules/extension","background/subscription","background/thumb/videoStream","models/sysinfo","modules/debug","modules/ciccore","modules/cicregistration","comms.websocket","modules/image","background/thumb/videoStream"],e):"object"==typeof exports&&(module.exports=e(require("comms.nc.protocol"),require("utf8"),require("flag"),require("background/translate"),require("pubsub"),require("student"),require("background/CLIENT"),require("accept"),require("mouse"),require("chatlib"),require("models/survey"),require("modules/image"),require("modules/extension"),require("background/subscription"),require("background/thumb/videoStream"),require("models/sysinfo"),require("modules/debug"),require("comms.websocket"),require("modules/image"),require("background/thumb/videoStream")))}(function(s,l,a,u,e,d,n,t,o,g,h,r,m,C,S,b,p,w,v,A,T,k,y,E,R){const L={},I=t();var D,F={};big=[];var O;localStorage.thumbnailsInitiated=!1;localStorage.doDisconnect=!1;var M,N,W,P,U=[],q=!0;function V(){chrome.runtime.sendMessage({createDesktopCaputreScreen:!0})}return L.Subscribe=function(e,t){return e&&t&&t instanceof Function?(e=String(e),F[e]=F[e]||[],void F[e].push(t)):F[e]||null},L.Process=function(e){this.csParams=d,this.d=e,this.Client=n,localStorage.lastConnected=(new Date).getTime(),this.FF=a.Get(e,2),this.FFFF=a.Get(e,4),this.cid=e.substr(0,4),this.nc=e.charCodeAt(4),this.nc===s.BIGNEASY&&(this.BigEasy(),this.FF=a.Get(this.d,2),this.FFFF=a.Get(this.d,4)),sm=0,this.ActiveConnection=this.csParams.Connections[this.cid],sm=this.ActiveConnection?this.ActiveConnection.sm:0,this.nc==s.LOGIN&&1==sm?this.Login():this.nc==s.SELECT&&2==sm&&this.Select([]),this.Perform(this.nc)},L.Perform=function(e){if(e&&F[e]){const a=this;F[e].forEach(function(e){return e.call(a,a.d)})}else switch(e){case s.FLUSH:this.Flush();break;case s.SYSINFO:this.SysInfo(),this.SendTabData();break;case s.RECONNECT:this.Reconnect();break;case s.TICKLE:case s.EXEC:case s.BATTERY:this.BatteryInfo();break;case s.WIRELESS:this.Wireless();break;case s.DCAFPAL:console.debug("DEBUG REPLACED METHOD HERE"),this.Palette();break;case s.SDATA:this.ActiveConnection.stream+=this.d.substr(6);break;case s.EDATA:this.ActiveConnection.stream="";break;case s.SOS_CLEAR:case s.LATLONG:case s.ECDATA:break;case s.CLIPDATA:this.Clipboard();break;case s.SETMODE:var t=this.FF(6);this.SetMode(t);break;case s.NEWSCRAPE:this.NewScrape();break;case s.WSLAVE:this.ShowScaling();break;case s.VIDEOHINT:this.VideoHint();break;case s.GETMONITORS:chrome.runtime.sendMessage({getWindowCurrent:!0},function(e){e&&L.ChromeWindow(n.View,e,4,function(e,t){return String.fromCharCode(s.GETMONITORS)+z+z2+String.fromCharCode(1)+z+z2+z4+z4+z4+String.fromCharCode(255&e)+String.fromCharCode(e>>8)+z2+String.fromCharCode(255&t)+String.fromCharCode(t>>8)+z2+z})});break;case s.KEYSTROKES:this.Keyboard();break;case s.GIVE_REWARD:this.giveReward();case s.AUDIOSTAT:case s.JOURNAL:break;case s.STUDENTUI:this.StudentUI();break;case s.MESSAGE:this.Message();break;case s.MESSAGEEX:this.MessageEx();break;case s.SHOWRANDOMSELECTION:this.RandomSelctionShowQuestonMark();break;case s.VOTE:this.Vote();break;case s.VOTESHOWRESULT:localStorage.surveyAnswered&&this.VoteShowResult();break;case s.CHATEX:this.Chat();break;case s.APPROVEDWEBLIST:this.ApprovedWebList();break;case s.WINMOUSE:this.WinMouse();break;case s.THUMBNAIL:this.Thumbnail();break;case s.PLUGIN:console.debug("REPLACED Plugin packet"),this.Plugin();break;case s.REGISTER_USER:CSParams.Register=new r(this.cid),localStorage.registerUserCid=this.cid,this.RegisterStudent(this.d);break;case s.CANCEL_REGISTER:localStorage.cancelRegister=!0,b.cancelRegister();break;case s.NC_JSON:this.ncJson();break;case s.WEBRTC:this.webRTC();break;case s.LEAVECLASS:this.leaveClass();break;case s.MUTESOUND:this.mutesound();break;default:this.d.length}},L.ncJson=function(a){var e;if(a)try{if(!(e=JSON.parse(a))||!e.key)return!1}catch(e){return!1}let o=this["cid"];return setTimeout(()=>{isNaN(Number(o))&&4===o.length&&(o=o.split("").reverse().map(e=>e.charCodeAt(0)),o=bytes(o,4));const t=this;F[String(235)].forEach(function(e){return e.call(t,{cid:o,Data:a})})},0),!0},L.Login=function(){if(db.altdebug("392 nc.Login CALLED"),localStorage.isHangup=!1,localStorage.loginInitiated=!0,T.core.checkConnectionActivity(),db.altdebug("404 AFTER checkConnectionActivity NOT CALLED"),chrome.runtime.onMessage.addListener(function(e,t,a){1==e.clearVideoScreenInterval&&require(["student"],function(e){if(0==Object.keys(e.Connections).length)for(i=0;i<U.length;i++)clearInterval(U[i]);else for(i=0;i<U.length-1;i++)clearInterval(U[i])})}),chrome.runtime.onMessage.addListener(function(e,t,a){if(1==e.clearVideoScreenIntervalAll)for(i=0;i<U.length;i++)clearInterval(U[i])}),localStorage.cancelRegister=!1,localStorage.hangupCalled=!1,localStorage.hangupReceived=!1,chrome.runtime.sendMessage({storeLocal:!0,data:{isHangupCalled:!0,hangupCalled:!1}}),clearTimeout(localStorage.unlockTimeout),512&(P=this.FF(6))){var e=this.d.substr(41,5)!=gPin?(db.altdebug("441 nc.Login - REJECT notmypin"),String.fromCharCode(s.REJECT,0,25,0,0)):(db.altdebug("445 nc.Login - REJECT"),String.fromCharCode(s.REJECT,0,5,0,0));b.senddata(this.cid,e)}else{var t,a=0;for(t in CSParams.Connections)a+=1;"false"==localStorage.shared&&1<a?(db.altdebug("457 nc.Login - REJECT connection"),e=String.fromCharCode(s.REJECT,0,1,0,0),b.senddata(this.cid,e)):(db.altdebug("462 nc.Login - before removeclasscodeUI"),localStorage.removeClassCodeUI=!0,chrome.runtime.sendMessage({text:"closeRemoveClassCodeUI"}),db.altdebug("466 nc.Login - after removeclasscodeUI"),e=String.fromCharCode(s.CONFIG)+z+z2+"Client"+z+"DisableAudio=9"+z+"DisableAnnotate=9"+z+"DisableBlankScreen=9"+z+"DisableControl=9"+z+"DisableShare=9"+z+"DisableExec=9"+z+"DisableFileTransfer=9"+z+"DisableInventory=9"+z+"DisableJournal=9"+z+"DisableLogoff=9"+z+"DisableLogon=9"+z+"DisablePowerOff=9"+z+"DisablePrintCapture=9"+z+"DisableReboot=9"+z+"DisableRemoteCmd=9"+z+"DisableRegistryIO=9"+z+"DisableSAS=9"+z+"DisableStudentUI=9"+z+"Channel="+(l.Required(localStorage.roomspec)?" ":localStorage.roomspec)+z+"ChromeUtf8=1"+z+"ChannelUtf8="+l.ForceEncode(localStorage.roomspec)+(l.Required(localStorage.clientName)?z:z+"CurrentUserName="+localStorage.clientName)+("true"==localStorage.googleAdminAccess&&"true"==localStorage.isManaged&&null!=localStorage.name?z+"CurrentRealname="+localStorage.name+z:z)+"_License"+z+"Product="+productCode+z+z,db.altdebug("488 nc.Login - after config assignment"),db.altdebug("489 nc.Login - config sent: "+e),b.senddata(this.cid,e),b.senddata(this.cid,I),chrome.runtime.sendMessage({getSync:!0,data:["rewardCount"]},function(e){O=e.rewardCount,NC_GIVE_REWARD=String.fromCharCode(181,0,parseInt(O),0,0,0),b.senddata(this.cid,NC_GIVE_REWARD)}),chrome.runtime.sendMessage({getLocal:!0,data:["batteryCharging","batteryLevel"]},function(e){e.hasOwnProperty("batteryCharging")&&e.hasOwnProperty("batteryLevel")&&(e=String.fromCharCode(183,0,1,"Yes"==e.batteryCharging?1:0,parseInt(e.batteryLevel.split("%")[0])),b.senddata(this.cid,e))}),chrome.runtime.sendMessage({getLocal:!0,data:["networkType"]},function(e){"ethernet"!=e.networkType&&(e=String.fromCharCode(184,0,1,0,"0",100,1,e.networkType+"\0",0),b.senddata(this.cid,e))}),this.ActiveConnection.sm=2,localStorage.lastSentNameForRegister=localStorage.clientName,T.core.updateBrowserActionStatus(1,!0))}},L.Reconnect=function(){this.csParams.reconnectMode.active=this.d.charCodeAt(6),this.csParams.reconnectMode.id=this.d.substr(39,38),A("RECONNECT Received:"+this.csParams.reconnectMode.id)},L.BatteryInfo=function(){chrome.runtime.sendMessage({getLocal:!0,data:["batteryCharging","batteryLevel"]},function(e){if(e.hasOwnProperty("batteryCharging")&&e.hasOwnProperty("batteryLevel")){var t,a=String.fromCharCode(183,0,1,"Yes"==e.batteryCharging?1:0,parseInt(e.batteryLevel.split("%")[0]));for(t in CSParams.Connections)null!=t&&b.senddata(t,a)}})},L.Wireless=function(){chrome.runtime.sendMessage({getLocal:!0,data:["networkType"]},function(e){e=String.fromCharCode(184,0,1,0,"\0",100,1,e.networkType+"\0",0);b.senddata(this.cid,e)})},L.Select=function(){!function(e){e=e.substring(16,e.length).split(z)[4];localStorage.teacher=e;e=u("WATCHING")+" "+e;chrome.runtime.sendMessage({updateTeacherName:!0,teacherName:e})}(this.d),function(e){e=e.substring(16,e.length).split(z)[12];localStorage.className=e}(this.d),"true"!=localStorage.getItem("forceUserAcknowledgement")&&"1"!=localStorage.getItem("useracknowledge")||"false"!=localStorage.getItem("useracknowledgeAccepted")||"true"==localStorage.joinClassInitiated?(T.core.userack.completeConnectionDefaultNoAcknowledgement(cid,this.d),localStorage.joinClassInitiated=!1):T.core.userack.displayUserAcknowledgement(this.d)},chrome.runtime.onMessage.addListener(function(e,t,a){"completeConnection"==e.text&&function(e){"true"==e?(localStorage.connectedToTutor=!0,b.senddata(this.cid,I)):(localStorage.connectionState="connected_NCS",chrome.runtime.sendMessage({storeLocal:!0,data:{connectionState:"connected_NCS"}}),reject=String.fromCharCode(s.REJECT,0,2,0,0),b.senddata(this.cid,reject))}(e.acceptConnection)}),chrome.runtime.onMessage.addListener(function(e){1==e.fetchMuteStatus&&0==localStorage.hangupCalled&&muteUnMuteSound()}),L.giveReward=function(){var a=this.d.charCodeAt(6);chrome.runtime.sendMessage({getSync:!0,data:["rewardCount"]},function(e){var t="NaN"==e.rewardCount||null==e.rewardCount?0:e.rewardCount;"1"==a?(e=parseInt(t)+1,localStorage.rewardCount=e,chrome.runtime.sendMessage({storeSync:!0,data:{rewardCount:e}})):"255"==a?0<parseInt(t)&&(t=parseInt(t)-1,localStorage.rewardCount=t,chrome.runtime.sendMessage({storeSync:!0,data:{rewardCount:t}})):"0"!=a&&"255"==a||(localStorage.rewardCount=0,chrome.runtime.sendMessage({storeSync:!0,data:{rewardCount:0}}))})},L.RandomSelctionShowQuestonMark=function(){var e=this.d,t=e.charCodeAt(8),a=e.charCodeAt(9);1===t&&2!=a&&(e.charCodeAt()&&NSLibrary.Client.RandomSelectSplash.showRandomSelectSplash(),setTimeout(function(){NSLibrary.Client.RandomSelectSplash.removeRandomSelectSplash()},2e3)),0==a?localStorage.setItem("randomSelectSplashAudio","false"):1==a&&localStorage.setItem("randomSelectSplashAudio","true")},L.MessageEx=function(){T.core.message.showMessageDialogForRandomSelect(this.d)},L.webRTC=function(){let e=this.d;var t=e.charCodeAt(6),a=e.substring(e.indexOf("https"));switch(t){case 0:NSLibrary.Client.webRTCTutorFullScreen.removeWebRTCTutorFullScreen(),NSLibrary.Client.webRTCTutorWindowed.removeWebRTCTutorWindowed(),localStorage.showWebRTCTutorFullscreen=!1,localStorage.showWebRTCTutorWindowed=!1,chrome.runtime.sendMessage({storeLocal:!0,data:{showWebRTCTutorFullscreen:!1}}),navigator.keyboard.unlock();break;case 1:NSLibrary.Client.webRTCTutorFullScreen.showWebRTCTutorFullScreen(a),localStorage.showWebRTCTutorFullscreen=!0,chrome.runtime.sendMessage({storeLocal:!0,data:{showWebRTCTutorFullscreen:!0}});break;case 2:NSLibrary.Client.webRTCTutorWindowed.showWebRTCTutorWindowed(a),localStorage.showWebRTCTutorWindowed=!0;break;case 3:NSLibrary.Client.webRTCTutorWindowed.showWebRTCTutorFullScreen(a)}},L.Flush=function(){4096&(P=this.FF(12))&&null!=this.ActiveConnection&&(this.ActiveConnection.utf8=!0,l.SetUTF8(this.ActiveConnection.cid))},L.SysInfo=function(){let t=this.cid;require(["models/sysinfo"],function(e){e?b.senddata(this.cid,e.string):chrome.runtime.sendMessage({getLocal:!0,data:"sysinfo"},function(e){b.senddata(t,e.sysinfo.string)})})},L.Vote=function(){A("in VOTE");var e=this.d,t=this.d.charCodeAt(6),a=e.indexOf(String.fromCharCode(9),6);0<=a?(zx=e.indexOf(z,a+1),question=l.Decode(e.substring(8,a),this.cid),options=l.Decode(e.substring(a+1,zx),this.cid),options=options.trim().replace(/ *; *| *, */g,","),d.Survey=new C(this.cid,question,options,t),m.Make("survey.html","Survey")):b.cancelSurvey()},L.VoteShowResult=function(){var e,t;A("in VOTESHOWRESULT");var a=0;zx=this.d.indexOf(z,6);var o,r=l.Decode(this.d.substring(6,zx-1),this.cid),s=this.d.charCodeAt(zx+1);d.Survey.Answers;if(1!=s)for(t=(o=r.split("\t"))[1],question=o[2],o.splice(0,3),d.Survey.Answers=[],e=[],i=0;i<o.length;++i)x=o[i].split("\n"),d.Survey.Answers.push(x[0]),e.push(x[1]);if(e)for(i=0;i<e.length;i++)a+=parseInt(e[i],10);if(void 0===d.Survey.Answers||void 0===e)m.Remove("SurveyResults");else{surveyResults="";var n=d.Survey.Answers.length;for(i=0;i<n;i++){var c=0!==t&&e?100*e[i]/a:0;surveyResults=surveyResults+c.toFixed(2)+"%    "+d.Survey.Answers[i]+"\r\n"}b.setSurveyResults(surveyResults),m.Remove("SurveyResults"),m.Make("results.html?question="+d.Survey.Question+"&response="+encodeURIComponent(surveyResults),"SurveyResults")}},L.RegisterStudent=function(e){A("in STUDENTREGISTER"),P=this.FF(6),f=a.Check(P);var t={FirstName:f(1),Surname:f(2),UserName:f(512),ClassName:f(4),StudentID:f(8),Custom1:!1,Custom2:!1};x=12,zx=e.indexOf(z,x),c=a.CheckAssign(P,d.Register.Cid),c(16,function(e){t.Custom1=e},e.substring(x,zx))&&(x=zx+1,zx=e.indexOf(z,x)),c(32,function(e){t.Custom2=e},e.substring(x,zx))&&(x=zx+1,zx=e.indexOf(z,x)),c(64,function(e){d.Register.Teacher=e},e.substring(x,zx))&&(x=zx+1,zx=e.indexOf(z,x)),c(128,function(e){d.Register.Lesson=e},e.substring(x,zx))&&(x=zx+1,zx=e.indexOf(z,x)),c(256,function(e){d.Register.Room=e},e.substring(x,zx))&&(x=zx+1,zx=e.indexOf(z,x)),(this.csParams.Register.Student=t).Custom1||t.Custom2?chrome.runtime.sendMessage({createWindow:!0,windowData:{url:"quickregister.html",focused:!0,type:"popup",width:760,height:380,left:screen.width/2-380,top:screen.height/2-190}},function(e){localStorage.registerNameWindow=e.id}):b.studentRegister({userName:localStorage.userName})},L.BigEasy=function(){var e=this.FFFF(10);more=this.d.charCodeAt(14);var t,a=this.d.substr(15);for(found=0,i=0;i<big.length;++i)if(big[i][0]==this.cid&&big[i][1]==e){if(found=!0,more)return void(big[i][2]=big[i][2]+a);this.d=this.cid+big[i][2]+a,this.nc=this.d.charCodeAt(4),big.splice(i,1)}found||(t=this.FFFF(6),big.push([this.cid,e,a,t]))},L.Palette=function(){show=h;var e=this.FF(6);more=this.d.charCodeAt(8);var t=10;256<=show.palette.length&&(show.palette=[]);for(var a=0;a<e;++a){var o=this.d.charCodeAt(t+2),i=this.d.charCodeAt(t+1),r=this.d.charCodeAt(t);show.palette.push([o,i,r]),t+=4}},L.Clipboard=function(){var e;if(16&(P=this.FF(12))){var t=String.fromCharCode(s.CLIPDATA,0,1,0,0,0,0,0,32,0,0,0,0,0,0,0);b.senddata(this.cid,t)}else if(4&P){t=(e=n.Clipboard.getClipboardText()).length+1,t*=2;for(var a=String.fromCharCode(s.CLIPDATA,0,13,0,255&t,t>>8&255,0,0,3,0,0,0,0,0,255&t,t>>8&255),o=0;o<e.length;++o)a+=String.fromCharCode(255&e.charCodeAt(o),e.charCodeAt(o)>>8);a+=z2,b.senddata(this.cid,a);t=String.fromCharCode(s.CLIPDATA,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0);b.senddata(this.cid,t)}else if(3==(3&P))if(1==this.d.charCodeAt(6))zx=this.d.indexOf(z,20),e=this.d.substring(20,zx),n.Clipboard.setClipboardText(e);else if(13==this.d.charCodeAt(6)){for(o=20,e="";0!==(ch=this.d.charCodeAt(o)+256*this.d.charCodeAt(o+1));)e+=ch,o+=2;n.Clipboard.setClipboardText(e)}},L.SetMode=function(e){var t=this.FF(8),a=n.View;8&e&&(h.isFullScreen=!(4&t)&&(8&t||16384&t)?0:1,h.startShow()),1&e?(localStorage.hangupCalled=!1,a.viewCid=this.cid,a.isScraping||(w.enable(),w.getDimensions().then(L.SendWSlave).then(function(e){e.getScreen(),localStorage.showStarted=!0,localStorage.createDesktopCaputreScreenInterval=setInterval(function(){chrome.runtime.sendMessage({queryTabs:!0,tabData:{url:chrome.runtime.getURL("desktopCapture.html")}},function(e){0==e.length&&("true"==localStorage.shareScreenClosed&&"true"==localStorage.hangupReceived||"0"==localStorage.disablefulldesktopview&&V())})},1e3),e.isScraping=1,localStorage.isWatching=!0,T.core.updateBrowserActionStatus(2,!0)}))):(a.isScraping&&(window.clearInterval(a.timer),a.isViewRestart=1,a.isScraping=0,localStorage.isWatching=!1,chrome.runtime.sendMessage({closeAcknowledgeDialog:!0}),T.core.updateBrowserActionStatus(2,!1),localStorage.showStarted=!1),4096==e&&(h.endShow(),this.csParams.Show.Width=void 0)),!(2048&e)||!tcpConnected&&2048&this.ActiveConnection.mode?2048&e||!(tcpConnected||2048&this.ActiveConnection.mode)||(n.Lock.unlockClient(),localStorage.offlineLock=!1,localStorage.unlockCalled=!0):(n.Lock.lockClient(),localStorage.offlineLock=!0,localStorage.unlockCalled=!1),tcpConnected||(this.ActiveConnection.mode=e)},L.ShowScaling=function(){var e=this.d;colorbits=e.charCodeAt(8),this.csParams.Show.Width=this.FF(12),this.csParams.Show.Height=this.FF(14),h.xOffset=21<e.length?this.FF(18):0,h.yOffset=21<e.length?this.FF(20):0,h.Height=this.csParams.Show.Height,h.Width=this.csParams.Show.Width,h.backBufferCanvas.width=h.Width,h.backBufferCanvas.height=h.Height,h.Scale(CSParams.ScreenDimensions.height,CSParams.ScreenDimensions.width),h.dimensionsSet=!0},L.VideoHint=function(){if(0===this.d.charCodeAt(6)){var e=h,t=this.csParams.Show.Width,a=this.csParams.Show.Height;e.tempShowCanvas.width=t,e.tempShowCanvas.height=a;var o=e.fragments;e.fragments=[];for(var i=0;i<o.length;++i)e.tempShowContext.putImageData(o[i].imagedata,o[i].xpos,o[i].ypos);e.fragments=[],e.displayContext.drawImage(e.tempShowCanvas,0,0,t,a,0,0,t,a),e.dimensionsSet&&(e.backBufferContext.drawImage(e.tempShowCanvas,0,0,t,a),e.backBufferContext.drawImage(e.displayCanvas,0,0,t,a),e.dimensionsSet=0)}},L.Keyboard=function(){for(var e=n.Keyboard,t=this.d,a=!1,o=t.charCodeAt(6),i=0;i<o;++i){var r=t.charCodeAt(8+i);255==r?(++i,r=t.charCodeAt(8+i),e.sendAscii(r)):224==r?a=!a:r<128?(e.sendScanCode(r,a),a=!1):170==r||182==r?e.shiftStatus=!1:157==r?e.ctrlStatus=!1:184==r&&(e.altStatus=!1)}},L.NewScrape=function(){show=h,width=this.FF(10),height=this.FF(12),32768<=height?(height=65536-height,show.isUpsideDown=!1):show.isUpsideDown=!0,show.tempShowCanvas.width=width,show.tempShowCanvas.height=height,colorbits=this.d.charCodeAt(14);var e=this.d.substr(15),t=show.rleDecode(e),a="";if((e=8!==colorbits?t.length/2:t.length)>width*height){for(var o=e/height-width,i=0;i<t.length;)a+=t.substr(i,width),i+=width+o;t=a}e=8===colorbits?show.decodeBMP256(t):show.decodeBMP(t,show.isUpsideDown),xpos=this.FF(6)-show.xOffset,ypos=this.FF(8)-show.yOffset,show.PushFragment(xpos,ypos,e)},L.StudentUI=function(){var e=this.d,t=e.charCodeAt(14);1===t?this.StudentFeedback(e):2===t||(4==t?function(e){let t="",a="",o=0;for(i=22;i<e.length;i++){if(0==e.charCodeAt(i)){o=i;break}a+=e.charAt(i)}for(i=o+2;i<e.length&&0!=e.charCodeAt(i);i++)t+=e.charAt(i);var r=e.split("@")[2].split("|")[0],s=e.split("@")[2].split("|")[1];localStorage.objectives=l.Decode(r,this.cid),localStorage.outcomes=null==s?"":l.Decode(s,this.cid),localStorage.teacherName=l.Decode(t,this.cid),localStorage.lessonTitle=l.Decode(a,this.cid)}(e):199==t&&(1==e.charCodeAt(10)?localStorage.showInernetObjectiveUI=!0:(localStorage.showInernetObjectiveUI=!1,chrome.runtime.sendMessage({lessonObj:!0}))))},L.Message=function(){T.core.message.showMessageDialog(this.d,this.cid)},L.Plugin=function(){var e,t,a,o,i,r=this.d;2==r.charCodeAt(6)?(cmd=r.charCodeAt(14),pcmd=r.charCodeAt(18),3==cmd||(7!=cmd&&13!=cmd||5!=pcmd?7!=cmd&&13!=cmd||6!=pcmd?7!=cmd&&13!=cmd||2!=pcmd?7!=cmd&&13!=cmd||1!=pcmd?A("web plugin, cmd="+cmd+", pcmd="+pcmd):(termIndex=r.indexOf(String.fromCharCode(0),42),t=r.substring(42,termIndex),a=null!=localStorage.bookwidgetsSSO&&""!=localStorage.bookwidgetsSSO?localStorage.bookwidgetsSSO:"",db.altdebug("1525 nc.Plugin url: "+t),db.altdebug("1526 nc.Plugin sso: "+a),-1!=t.indexOf("www.bookwidgets.com")?-1!=t.indexOf("&sso=")?1<(o=t.split("&sso=")).length&&""!=o[1]?(m.MakeExternal(t),db.altdebug("1532 url: "+t)):(""!=a&&(t+=a),m.MakeExternal(t),db.altdebug("1538 url: "+t)):(m.MakeExternal(t=""!=a?t+"&sso="+a:t),db.altdebug("1545 url: "+t)):m.MakeExternal(t)):(e=r.charCodeAt(42)+(r.charCodeAt(43)<<8)+(r.charCodeAt(44)<<16)+(r.charCodeAt(45)<<24),chrome.runtime.sendMessage({removeTab:!0,tabID:e,errorMessage:""})):(this.csParams.Connections[this.cid].webpoll=1,m.PollActive()):(zx=r.indexOf(z,42),i=r.substring(42,zx),this.csParams.Connections[this.cid].webpoll=1,m.parseWebFilter(this.cid,i),m.filterTabs()))):1==r.charCodeAt(6)&&(cmd=r.charCodeAt(14),pcmd=r.charCodeAt(18),3==cmd?(i=String.fromCharCode(s.PLUGIN)+z+String.fromCharCode(1)+z3+z4+String.fromCharCode(3)+z3+z4+z4+z4+z2+z,b.senddata(this.cid,i),i=String.fromCharCode(s.PLUGIN)+z+String.fromCharCode(2)+z3+z4+String.fromCharCode(3)+z3+z4+z4+z4+z2+z,b.senddata(this.cid,i),i=String.fromCharCode(s.PLUGIN)+z+String.fromCharCode(2)+z3+String.fromCharCode(3)+z3+String.fromCharCode(7)+z3+z4+String.fromCharCode(5)+z3+z4+String.fromCharCode(5)+z+z,b.senddata(this.cid,i)):(7!=cmd&&13!=cmd||6!=pcmd)&&(7!=cmd&&13!=cmd||3!=pcmd?(7!=cmd&&13!=cmd||5!=pcmd)&&(7!=cmd&&13!=cmd||2!=pcmd?A("app plugin, cmd="+cmd+", pcmd="+pcmd):(e=r.charCodeAt(44)+(r.charCodeAt(45)<<8)+(r.charCodeAt(46)<<16)+(r.charCodeAt(47)<<24),chrome.runtime.sendMessage({removeTab:!0,tabID:e,errorMessage:""}))):(e=r.charCodeAt(44)+(r.charCodeAt(45)<<8)+(r.charCodeAt(46)<<16)+(r.charCodeAt(47)<<24),chrome.runtime.sendMessage({updateTab:!0,tabID:e,tabData:{active:!0,highlighted:!0}},function(e){chrome.runtime.sendMessage({windowsUpdate:!0,windowId:e.windowId,winData:{focused:!0,drawAttention:!0}})}))))},L.leaveClass=function(){db.altdebug("1571 leaveClass"),localStorage.removeClassCodeUI=!1,localStorage.roomspec=localStorage.storedChannel,db.altdebug("1574 ROOMSPEC: "+localStorage.roomspec),localStorage.lastEnteredValidCode=void 0,y.instance.STATUS_CLASSCODE(localStorage.roomspec,0),db.altdebug("1566 STATUS_CLASSCODE sending roomspec: "+localStorage.roomspec),db.altdebug("1567 leaveClass - roomspec: "+localStorage.roomspec),localStorage.connectionStatusType=0,localStorage.joinClassInitiated=!1,localStorage.connectedToTutor=!1},L.mutesound=function(){var e=this.d;D=e.charCodeAt(6),T.core.muteUnMuteSound(D)},L.Chat=function(){A("in CHAT");var e=this.d,t="",a=g.instance(void 0,this.cid),o=(this.d.split("").map(e=>e.charCodeAt(0)),e.indexOf(z,14)),i=e.indexOf(z,30),r=e.indexOf(z,i+1);P=this.FF(10)+(e.charCodeAt(13)<<24);var s,n,c,d=e.charCodeAt(12)<<16;switch(sender=e.substring(14,Math.min(o,30)),-1!==i&&(t=l.Decode(e.substring(30,i),this.cid)),-1!==r&&i+1<r&&(sender=l.Decode(e.substring(i+1,r),this.cid)),P){case 1:a=new g(e.substring(6,10),this.cid),g.instance(a),g.setTitle(a,""),65536==d&&g.setTitle(t),g.startChat(a),g.sendChatJoin(a),localStorage.hangupCalled=!1;break;case 2:g.addJoinedMessage(JSON.parse(a),sender);break;case 3:g.addLeftMessage(JSON.parse(a),sender);break;case 4:g.addMessage(JSON.parse(a),sender,t),chrome.runtime.sendMessage({queryTabs:!0,tabData:{}},e=>{var t,a=localStorage.chatUrl;for(t in e)void 0!==e[t]&&e[t].url===a&&(chrome.runtime.sendMessage({tabsUpdate:!0,tabID:e[t].id,tabData:{active:!0}}),chrome.runtime.sendMessage({getChatWindowID:!0}))});break;case 5:null!=a&&JSON.parse(a).isChatting&&(s="",n=u("TUTOR_HAS_LEFT_CHAT"),h=8,c=new Notification(s,{body:n,icon:"images/message48.png"}),h&&setTimeout(function(){c.close()},1e3*h));var h=JSON.parse(localStorage.chatInstances);null!=h&&null!=h[this.cid]&&(h=JSON.parse(h[this.cid]),g.eject(h.tabID),require(["background/CLIENT"],function(e){"false"==localStorage.unlockCalled&&e.Lock.lockClient()}));break;case 13:tmpSaysLowerCase=u("says").charAt(0).toLowerCase()+u("says").slice(1),-1<t.indexOf(tmpSaysLowerCase)?tmpSender=t.substring(0,t.indexOf(tmpSaysLowerCase)):""!==tmpSender&&""!==t&&void 0!==t&&(a.addMessage(tmpSender,t),tmpSender="")}},L.ApprovedWebList=function(){P=this.d.charCodeAt(6),x=22,zx=this.d.indexOf(z,x);var e=this.d.substring(x,zx);1&P&&(gApproved=""),gApproved+=e.replace(",","."),localStorage.approvedWebList=gApproved.split("\n")},L.WinMouse=function(){for(var e=this.FF(6),t=8;e--;)xpos=this.d.charCodeAt(t)+(this.d.charCodeAt(t+1)<<8),ypos=this.d.charCodeAt(t+2)+(this.d.charCodeAt(t+3)<<8),32767==xpos?o.click(ypos):32766==xpos?(32768<=ypos&&(ypos-=65536),chrome.runtime.sendMessage({executeScript:!0,scriptData:{code:"window.scrollBy(0,"+-ypos+");"}})):(o.x=xpos,o.y=ypos),t+=4},L.Thumbnail=function(){M=setInterval(function(){chrome.runtime.sendMessage({queryTabs:!0,tabData:{url:chrome.runtime.getURL("desktopCapture.html")}},function(e){0==e.length&&0!=W&&("0"==localStorage.disablefulldesktopview&&"false"==localStorage.isHangup?V():clearInterval(M))})},1e3),U.push(M),db.altdebug("1813 nc.Thumbnail CALLED: "),connection=this.csParams.Connections[this.cid],db.altdebug("1815 cid: "+this.cid),null==connection?db.altdebug("1816 connection undefined"):db.altdebug("1818 connection exists"),db.altdebug("1821 Connections[] length: "+Object.keys(this.csParams.Connections).length),1&(P=this.d.charCodeAt(6)+(this.d.charCodeAt(7)<<8))&&(connection.thumbnailType="image/jpeg"),W=256*this.d.charCodeAt(15)+this.d.charCodeAt(14),connection.thumbi=W,connection.thumbs=W,connection.thumbw=256*this.d.charCodeAt(11)+this.d.charCodeAt(10),connection.thumbh=256*this.d.charCodeAt(13)+this.d.charCodeAt(12),connection.thumblast="",0===W?q=!1:(q=!0,window.clearInterval(N),w.enable(),N=setInterval(()=>{w.confirmStream(),q?S.takeScreenshot(!0):S.takeScreenshot(!1)},1e3*W)),W&&p.on.interval.call()},L.ChromeWindow=function(e,t,a,o){for(w.isActive()?(e.width=screen.availWidth,e.height=screen.height):screen&&(screen.availWidth<screen.height?(e.width=screen.height,e.height=screen.availWidth):(screen.availWidth<screen.height&&localStorage.wasPortraitAndActive,e.width=screen.availWidth,e.height=screen.height)),last2digits=e.width%100;last2digits%4!=0;)e.width=e.width+1,last2digits=e.width%100;e.gridSizeX=e.width,e.gridSizeY=32,e.canvas.width=e.gridSizeX,e.canvas.height=e.gridSizeY,e.nrX=Math.round(e.width/e.gridSizeX),e.nrY=Math.round(e.height/e.gridSizeY),e.pixelCount=e.gridSizeX*e.gridSizeY*4,width=e.width,height=e.height,data=o(width,height),b.senddata(this.cid,data)},L.SendTabData=function(){let t=CSParams.Connections[this.cid];m.getAllTabsFromOpenWindows().then(function(e){t.force=!0,e.forEach(m.SendData),t.force=!1}),CSParams.get.currentWindow().then(m.updateCurrentWebsite)},L.SendWSlave=function(a){let o=(e,t)=>String.fromCharCode(s.WSLAVE)+z+z2+String.fromCharCode(16)+z+z2+String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&t)+String.fromCharCode(t>>8&255)+z2;return new Promise((e,t)=>{View?(L.ChromeWindow(View,a,4,o),e(View)):(L.ChromeWindow(NSLibrary.Client.View,a,4,o),e(NSLibrary.Client.View))})},L});