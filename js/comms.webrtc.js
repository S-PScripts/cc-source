"use strict";!function(e){"function"==typeof define&&define.amd?define(["settings"],e):"object"==typeof exports&&(module.exports=e(require("settings")))}(function(e){let t=null;let o=null,i={};return{webrtc:function([e,t,n]){return o=e,i={subscribe:t,dispatch:n},!0},start:function(){t.initiator=!0,function(){let{constraints:e,sourceType:t}=conf(),o={...e};if(!chrome||!chrome.desktopCapture)return new Promise(e=>{e(o)});const n=["screen","window","tab"];return t.map(e=>`${e}`.toLowerCase()).filter(e=>n.indexOf(e)+1),new Promise(n=>{chrome.desktopCapture.chooseDesktopMedia(t,(e,t)=>{o={...o,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e}},audio:t.canRequestAudioTrack},n(o)})}).catch(e=>{})}().then(e=>{navigator.mediaDevices.getUserMedia(e).then(e=>{t.local=e,emit("streaming"),t.initiator,bindMediaOnEnd(e)}).catch(e=>{resetState(),console.warn(e),emit("rejected")})})}}});