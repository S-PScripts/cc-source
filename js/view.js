var NSLibrary=NSLibrary||{};NSLibrary.Client=NSLibrary.Client||{},NSLibrary.Client.View=NSLibrary.Client.View||{},function(o){"use strict";o.canvas=document.createElement("canvas"),o.context=o.canvas.getContext("2d",{willReadFrequently:!0}),o.oldImage=document.createElement("img"),o.newImage=document.createElement("img"),o.pixelCount=0,o.timeout=500,o.gridSizeX=0,o.GridSizeY=0,o.nrX=0,o.nrY=0,o.timer=0,o.isScraping=0,o.width=0,o.height=0,o.isRestart=0,o.FRAMESTART=String.fromCharCode(189,0,1),o.FRAMEEND=String.fromCharCode(189,0,0),o.viewCid=-1,o.newImage.onload=function(){window.clearTimeout(o.timer);var e,r,i,t,a,n;if(1!=localStorage.hangupCalled){for(t=0;t<o.nrY;t++)r=t*o.gridSizeY,o.height-r<o.gridSizeY&&(a=o.gridSizeY,o.gridSizeY=o.height-r,n=o.pixelCount,o.pixelCount=o.gridSizeY*o.gridSizeX*4,o.canvas.height=o.gridSizeY),o.context.drawImage(o.oldImage,0,r,o.gridSizeX,o.gridSizeY,0,0,o.gridSizeX,o.gridSizeY),e=o.context.getImageData(0,0,o.gridSizeX,o.gridSizeY),o.context.drawImage(o.newImage,0,r,o.gridSizeX,o.gridSizeY,0,0,o.gridSizeX,o.gridSizeY),i=o.context.getImageData(0,0,o.gridSizeX,o.gridSizeY),o.compareImages(e,i,o.pixelCount)&&""!==o.oldImage.src||(i=o.createBMP(i),i=o.rleEncode(i),o.sendFrame(i,0,r,o.gridSizeX,o.gridSizeY));a&&(o.gridSizeY=a,a=void 0,o.canvas.height=o.gridSizeY),n&&(o.pixelCount=n,n=void 0),o.oldImage.src=o.newImage.src,o.isScraping&&(o.timer=window.setTimeout(o.getScreen,o.timeout))}},o.createBMP=function(e){var r,i,t,a=e.width,n=e.height,o=(4-3*a%4)%4,d=String.fromCharCode(0),g=e.data,m="",c="",S=n;do{for(var s=a*(S-1)*4,m="",u=0;u<a;u++)r=g[t=s+4*u],i=g[1+t],t=g[2+t],m+=String.fromCharCode(255&(i>>>3<<5|t>>>3)),m+=String.fromCharCode(255&(r>>>3<<2|i>>>6));for(var l=0;l<o;l++)m+=d}while(c+=m,--S);return c},o.getScreen=function(){var e;require(["modules/image","background/thumb/videoStream"],function(e,r){var i;r.confirmStream(),e.bareScreenshot().then(e=>{window.clearTimeout(o.timer),i=e.toDataURL("image/octet-stream",.5)||localStorage.defaultViewImg,o.newImage.src=i,o.isScraping&&(o.timer=window.setTimeout(o.getScreen,o.timeout))}),window.clearTimeout(o.timer),o.isScraping?o.timer=window.setTimeout(o.getScreen,o.timeout):clearInterval(parseInt(localStorage.createDesktopCaputreScreenInterval))}),o.isViewRestart&&(e=o.oldImage.src,o.oldImage.src="",o.newImage.src=e)},o.rleEncode=function(e){for(var r,i=0,t=e.length,a=String.fromCharCode(128,4);0!==t;){for(r=0;r<126&&8<=t&&e.substr(i,4)===e.substr(i+4,4);)++r,i+=4,t-=4;if(r)++r,a+=String.fromCharCode(r+128)+e.substr(i,4),i+=4,t-=4;else{for(;r<124&&8<=t&&e.substr(i+r,4)!==e.substr(i+r+4,4);)r+=4,t-=4;t<8&&r<=120&&(r+=t,t=0),a+=String.fromCharCode(r)+e.substr(i,r),i+=r}}return a},require(["modules/extension"],function(n){o.sendFrame=function(e,r,i,t,a){n.senddata(o.viewCid,o.FRAMESTART);e=String.fromCharCode(158,0,255&r,r>>8&255,255&i,i>>8&255,255&t,t>>8&255,255&a,a>>8&255,16)+e;n.senddata(o.viewCid,e),n.senddata(o.viewCid,o.FRAMEEND)}}),o.compareImages=function(e,r,i){for(var t=0;t<i;++t)if(e.data[t]!==r.data[t])return!1;return!0}}(NSLibrary.Client.View);