define("lib/queue",["background/storage"],function(i){function t(){return Promise.all([i.get("a"),i.get("b")]).then(function(t){this.a=t[0].a,this.b=t[1].b,void 0===this.a&&(this.a=[],this.b=0,i.set({a:this.a}),i.set({b:this.b}))}),this}return t.prototype.getLength=function(){Promise.all([i.get("a"),i.get("b")]).then(function(t){return this.a=t[0].a,this.b=t[1].b,this.a.length-this.b})},t.prototype.isEmpty=function(){i.get("a").then(function(t){if(t)return 0==t.a.length})},t.prototype.enqueue=function(e){i.get("a").then(function(t){t&&(e.phrasematch&&e.phrasematch.time&&(e.phrasematch.time=e.phrasematch.time.toISOString()),t.a.push(e),i.set({a:t.a}))})},t.prototype.dequeue=function(){Promise.all([i.get("a"),i.get("b")]).then(function(t){if(this.a=t[0].a,this.b=t[1].b,0!=this.a.length){t=this.a[this.b];return 2*++this.b>=this.a.length&&(this.a=this.a.slice(this.b),this.b=0),i.set({a:this.a}),i.set({b:this.b}),t}})},t.prototype.peek=function(e){setTimeout(function(){Promise.all([i.get("a"),i.get("b")]).then(function(t){this.a=t[0].a,this.b=t[1].b,result=0<this.a.length?this.a[this.b]:void 0,e(result)})},2e3)},{queue:t}});