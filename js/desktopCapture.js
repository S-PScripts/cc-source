window.onload=function(){require(["modules/translate"],e=>e()),localStorage.isStreamActive=!1;var s,o=document.createElement("canvas"),t=o.getContext("2d"),n=document.createElement("video"),r={width:void 0,height:void 0},i=void 0;chrome.storage.local.set({streamId:void 0}),chrome.storage.local.set({showingShareScreen:!0}),localStorage.streamId=void 0;var e=0,c=setInterval(function(){e=100<=e?0:e+5,document.getElementById("progress-bar").style.width=e+"%"},200);function d(e){m(),n.onloadeddata=d}function m(){t.drawImage(n,0,0,n.videoWidth,n.videoHeight);var e=o.toDataURL("image/webp",.6);chrome.runtime.sendMessage({sendDesktopImageDataURLForCicore:!0,desktopImageDataURL:e}),chrome.runtime.sendMessage({sendDesktopImageDataURLForImage:!0,desktopImageDataURL:e}),chrome.runtime.sendMessage({sendDesktopImageDataURLForEsafety:!0,desktopImageDataURL:e})}function g(){return new Promise(function(e){require(["background/thumb/videoStream"],function(e){e.confirmStream()})})}require(["lib/batch"],function(e){e.squash(e.token.desktopStream,8e3)}),window.onbeforeunload=function(){chrome.runtime.sendMessage({videoScreenClosed:!0})},document.addEventListener("visibilitychange",()=>{document.hidden&&"false"==localStorage.isStreamActive&&chrome.runtime.sendMessage({visibilityChange:!0})}),chrome.runtime.onMessage.addListener((e,t,a)=>{1==e.chooseDesktopMedia&&chrome.runtime.sendMessage({chooseDesktopMediaFromTab:!0,sourceType:["screen"]})}),chrome.runtime.onMessage.addListener(function(e,t,a){1==e.getMediaDevices&&navigator.mediaDevices.getUserMedia(e.settings).then(e=>{s=e,localStorage.shareScreenClosed=!1,localStorage.isStreamActive=e.active,chrome.runtime.sendMessage({setUseDesktopImageDataURLEsafety:!0,useDesktopImageDataURL:!0}),chrome.runtime.sendMessage({setUseDesktopImageDataURLCICCore:!0,useDesktopImageDataURL:!0}),c&&clearInterval(c),s.addEventListener("inactive",function(){require(["background/thumb/videoStream"],function(e){localStorage.isStreamActive=!1,chrome.storage.local.set({streamId:void 0}),g(e.isEstablished()),localStorage.shareScreenClosed=!0,chrome.runtime.sendMessage({setUseDesktopImageDataURLCICCore:!0,useDesktopImageDataURL:!1}),chrome.runtime.sendMessage({setUseDesktopImageDataURLEsafety:!0,useDesktopImageDataURL:!1}),close()})}),n.onloadedmetadata=e=>{var t;r.width=n.videoWidth,r.height=n.videoHeight,o.width=r.width,o.height=r.height,t=1e3,clearInterval(i),i=setInterval(e=>m(),t),chrome.runtime.sendMessage({getMediaDevicesResponse:!0,success:!0,dimensions:r})},n.autoplay=!0,n.srcObject=e,n.onloadeddata=d}).catch(e=>{chrome.runtime.sendMessage({getMediaDevicesResponse:!0,success:!1,e:e})})}),chrome.runtime.onMessage.addListener(function(e,t,a){1==e.confirmStream&&g()}),chrome.runtime.onMessage.addListener(function(e,t,a){1==e.endScreenshare&&(chrome.runtime.sendMessage({clearVideoScreenIntervalAll:!0}),localStorage.isStreamActive=!1,close())}),chrome.runtime.onMessage.addListener(function(e,t,a){1==e.minimizeDesktopCapture&&"true"==localStorage.isStreamActive&&chrome.runtime.sendMessage({minimize:!0})})};