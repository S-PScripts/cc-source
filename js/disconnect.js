!function(e){"function"==typeof define&&define.amd?define(["student","comms.websocket","models/Tab","background/CLIENT","chatlib","device","background/thumb/videoStream","on/lifecycle","modules/altdebug"],e):"object"==typeof exports&&(module.exports=e(require("student"),require("comms.websocket"),require("models/Tab"),require("background/CLIENT"),require("chatlib"),require("device"),require("background/thumb/videoStream"),require("on/lifecycle"),require("modules/altdebug")))}(function(c,a,l,r,s,u,d,e,g){function m(){c.Survey.Cid="",c.SurveyAnswers="",l.Remove("Survey"),l.Remove("SurveyResults")}return{reset:function(e,o){if(g.altdebug("86 doDisconnect"),g.saveLogs(),localStorage.isHangup=!0,localStorage.loginInitiated=!1,chrome.runtime.sendMessage({getLocal:!0,data:"connectionState"},function(e){"connected_NCS"!=e.connectionState&&"connected_TUTOR"!=e.connectionState&&"disconnected"==e.connectionState?(localStorage.connectionState="disconnected",chrome.runtime.sendMessage({storeLocal:!0,data:{connectionState:"disconnected"}})):(localStorage.connectionState="connected_NCS",chrome.runtime.sendMessage({storeLocal:!0,data:{connectionState:"connected_NCS"}}))}),c.Opened){if(a.instance.websocket&&a.instance.websocket.readyState<2&&!e&&(e=1e3,t="Disconnect",o&&o.code&&(e=o.code,t=o.message||t),a.instance.websocket.close(e,t)),d.disable(),m(),c.Room.Name="",r.View.isScraping=0,localStorage.doDisconnect=!0,r.Show&&r.Show.endShow(),r.View&&(r.View.isViewRestart=1),null!=localStorage.unlocktimeout&&"undefined"!=localStorage.unlocktimeout&&"0"!=localStorage.unlocktimeout&&"false"!=localStorage.offlineLock&&"undefined"!=localStorage.offlineConnection||r.Lock.unlockClient(),null!=localStorage.unlocktimeout&&"undefined"!=localStorage.unlocktimeout&&"0"!=localStorage.unlocktimeout||require(["modules/ciccore"],function(e){e.core.unMuteSound()}),setTimeout(function(){"false"==localStorage.hangupCalled?null!=localStorage.unlocktimeout&&""!=localStorage.unlocktimeout&&"0"!=localStorage.unlocktimeout?require(["modules/ciccore"],function(e){e.core.applyOfflineSettingsTimeout()}):null!=localStorage.unlocktimeout&&""!=localStorage.unlocktimeout&&"undefined"!=localStorage.unlocktimeout||(localStorage.unlocktimeout=30,require(["modules/ciccore"],function(e){e.core.applyOfflineSettingsTimeout()})):localStorage.hangupCalled=!1},2e3),null!=s.endChat&&null!=localStorage.chatInstances){var t=JSON.parse(localStorage.chatInstances),n=Object.values(t);for(i=0;i<n.length;i++)JSON.parse(n[i]).CID==o.cid&&(l.Remove("Chat"+JSON.parse(n[i]).tabID),s.endChat(JSON.parse(n[i])))}localStorage.chatInstances=JSON.stringify({}),c.powerMode=null,window.setTimeout(u.power.switchMode,9e4),debug("(doDisconnect) 90S switch powerMode: "+c.powerMode),UserAck&&("userack"==UserAck.userAckId&&chrome.notifications.clear("userack",function(){}),UserAck.acknowledged=0),window.clearInterval(parseInt(localStorage.thumbnailTimer)),chrome.runtime.sendMessage({showingShareScreen:!1}),function(){for(var e in c.tickle)window.clearInterval(c.tickle[e]),delete c.tickle[e]}(),chrome.runtime.sendMessage({storeLocal:!0,data:{respondToVisibilityChange:!1,isHangupCalled:!0}}),chrome.runtime.sendMessage({getLocal:!0,data:["persistentWindowID"]},function(e){chrome.runtime.sendMessage({windowsUpdate:!0,windowId:parseInt(e.persistentWindowID),winData:{focused:!0,state:"minimized"}})})}},Survey:m,Register:function(){c.Register.Cid="",null!=localStorage.registerNameWindow&&null!=localStorage.registerNameWindow&&chrome.runtime.sendMessage({windowsGetAll:!0,winData:{windowTypes:["popup"]}},function(e){e.forEach(function(e){e.id==localStorage.registerNameWindow&&chrome.runtime.sendMessage({removeWindow:!0,windowId:e.id})})})}}});